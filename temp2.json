{"openapi":"3.1.0","info":{"title":"UR5e Ontology RAG API","description":"제조 AX를 위한 온톨로지 기반 RAG API","version":"1.0.0"},"paths":{"/health":{"get":{"tags":["System"],"summary":"Health Check","description":"헬스체크","operationId":"health_check_health_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HealthResponse"}}}}}}},"/api/ontology/summary":{"get":{"tags":["System"],"summary":"Get Ontology Summary","description":"온톨로지 요약 정보","operationId":"get_ontology_summary_api_ontology_summary_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/chat":{"post":{"tags":["Chat"],"summary":"Chat","description":"채팅 API (Phase12 엔진 연동)\n\n사용자 질문을 받아 온톨로지 기반 추론 후 응답을 반환합니다.\n\n- **query**: 사용자 질문 (예: \"Fz가 -350N인데 이게 뭐야?\") - 권장\n- **message**: 사용자 질문 (하위 호환, query 없을 때 사용)\n- **context**: 추가 컨텍스트 (shift, product 등)\n\n응답에는 trace_id가 포함되며, /api/evidence/{trace_id}로\n근거 상세 정보를 조회할 수 있습니다.","operationId":"chat_api_chat_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/evidence/{trace_id}":{"get":{"tags":["Chat"],"summary":"Get Evidence","description":"근거 상세 조회\n\nchat API 응답의 trace_id로 전체 응답 및 근거 상세 정보를 조회합니다.\n프론트엔드에서 \"근거 보기\" 버튼 클릭 시 사용합니다.","operationId":"get_evidence_api_evidence__trace_id__get","parameters":[{"name":"trace_id","in":"path","required":true,"schema":{"type":"string","title":"Trace Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EvidenceResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sensors/readings":{"get":{"tags":["Sensors"],"summary":"Get Sensor Readings","description":"센서 측정값 조회\n\n최신 데이터부터 limit 개수만큼 반환합니다.\n프론트엔드 LiveView에서 실시간 차트 데이터로 사용합니다.","operationId":"get_sensor_readings_api_sensors_readings_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":1000,"minimum":1,"description":"반환할 레코드 수","default":60,"title":"Limit"},"description":"반환할 레코드 수"},{"name":"offset","in":"query","required":false,"schema":{"type":"integer","minimum":0,"description":"시작 오프셋 (최신 데이터 기준)","default":0,"title":"Offset"},"description":"시작 오프셋 (최신 데이터 기준)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SensorReadingsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sensors/readings/range":{"get":{"tags":["Sensors"],"summary":"Get Sensor Readings Range","description":"시간 범위 기반 센서 데이터 조회 (샘플링)\n\n7일치 데이터를 효율적으로 조회하기 위해 샘플링합니다.\n- hours: 최근 N시간 데이터 조회\n- samples: 반환할 데이터 포인트 수 (균등 샘플링)","operationId":"get_sensor_readings_range_api_sensors_readings_range_get","parameters":[{"name":"hours","in":"query","required":false,"schema":{"type":"integer","maximum":168,"minimum":1,"description":"조회할 시간 범위 (최대 168시간=7일)","default":1,"title":"Hours"},"description":"조회할 시간 범위 (최대 168시간=7일)"},{"name":"samples","in":"query","required":false,"schema":{"type":"integer","maximum":500,"minimum":10,"description":"반환할 샘플 수","default":200,"title":"Samples"},"description":"반환할 샘플 수"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sensors/patterns":{"get":{"tags":["Sensors"],"summary":"Get Sensor Patterns","description":"감지된 패턴 목록 조회\n\n충돌, 과부하, 드리프트 등 감지된 패턴 목록을 반환합니다.\n프론트엔드 HistoryView에서 패턴 테이블로 사용합니다.","operationId":"get_sensor_patterns_api_sensors_patterns_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"반환할 패턴 수","default":10,"title":"Limit"},"description":"반환할 패턴 수"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PatternsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sensors/events":{"get":{"tags":["Sensors"],"summary":"Get Sensor Events","description":"이상 이벤트 목록 조회\n\n시나리오 A/B/C에서 발생한 이상 이벤트 목록을 반환합니다.","operationId":"get_sensor_events_api_sensors_events_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":100,"minimum":1,"description":"반환할 이벤트 수","default":20,"title":"Limit"},"description":"반환할 이벤트 수"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/EventsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sensors/predictions":{"get":{"tags":["Sensors"],"summary":"Get Realtime Predictions","description":"이기종 결합 기반 실시간 예측\n\nAxia80 센서 데이터의 패턴과 온톨로지를 결합하여\n에러 발생을 사전 예측합니다.\n\n예측 경로:\n- Axia80 센서 → 패턴 감지 (PAT_COLLISION, PAT_OVERLOAD 등)\n- 패턴 → 온톨로지 추론 (TRIGGERS 관계)\n- 추론 → 에러 코드 예측 (C153, C189 등)","operationId":"get_realtime_predictions_api_sensors_predictions_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","maximum":50,"minimum":1,"description":"분석할 최근 이벤트 수","default":10,"title":"Limit"},"description":"분석할 최근 이벤트 수"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/PredictionsResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/sensors/stream":{"get":{"tags":["Sensors"],"summary":"Stream Sensor Data","description":"센서 데이터 SSE 스트림\n\nServer-Sent Events를 통해 실시간 센서 데이터를 스트리밍합니다.\n프론트엔드 LiveView에서 EventSource로 구독합니다.\n\n- interval: 데이터 전송 간격 (기본 1초)","operationId":"stream_sensor_data_api_sensors_stream_get","parameters":[{"name":"interval","in":"query","required":false,"schema":{"type":"number","maximum":10.0,"minimum":0.1,"description":"전송 간격 (초)","default":1.0,"title":"Interval"},"description":"전송 간격 (초)"}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"AnalysisInfo":{"properties":{"entity":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Entity"},"value":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Value"},"unit":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Unit"},"state":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"State"},"normal_range":{"anyOf":[{"items":{"type":"number"},"type":"array"},{"type":"null"}],"title":"Normal Range"},"deviation":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Deviation"}},"type":"object","title":"AnalysisInfo","description":"분석 정보"},"ChatRequest":{"properties":{"query":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Query","description":"사용자 질문 (권장)"},"message":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Message","description":"사용자 질문 (하위 호환)"},"context":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Context","description":"추가 컨텍스트 (shift, product 등)"}},"type":"object","title":"ChatRequest","description":"채팅 요청\n\nUI 명세서 기준: query 필드 사용\n하위 호환: message 필드도 허용 (query 우선)"},"ChatResponse":{"properties":{"trace_id":{"type":"string","title":"Trace Id","description":"추적 ID (근거 조회용)"},"query_type":{"type":"string","title":"Query Type","description":"질문 유형 (ontology/hybrid/rag)"},"answer":{"type":"string","title":"Answer","description":"자연어 응답"},"analysis":{"anyOf":[{"$ref":"#/components/schemas/AnalysisInfo"},{"type":"null"}]},"reasoning":{"anyOf":[{"$ref":"#/components/schemas/ReasoningInfo"},{"type":"null"}]},"prediction":{"anyOf":[{"$ref":"#/components/schemas/PredictionInfo"},{"type":"null"}]},"recommendation":{"anyOf":[{"$ref":"#/components/schemas/RecommendationInfo"},{"type":"null"}]},"evidence":{"$ref":"#/components/schemas/EvidenceInfo"},"graph":{"$ref":"#/components/schemas/GraphData"},"abstain":{"type":"boolean","title":"Abstain","description":"ABSTAIN 여부","default":false},"abstain_reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Abstain Reason"},"timestamp":{"type":"string","title":"Timestamp"}},"type":"object","required":["trace_id","query_type","answer"],"title":"ChatResponse","description":"채팅 응답 (Phase12 스키마)"},"EventInfo":{"properties":{"event_id":{"type":"string","title":"Event Id"},"scenario":{"type":"string","title":"Scenario"},"event_type":{"type":"string","title":"Event Type"},"start_time":{"type":"string","title":"Start Time"},"end_time":{"type":"string","title":"End Time"},"duration_s":{"type":"number","title":"Duration S"},"error_code":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error Code"},"description":{"type":"string","title":"Description"}},"type":"object","required":["event_id","scenario","event_type","start_time","end_time","duration_s","description"],"title":"EventInfo","description":"이벤트 정보"},"EventsResponse":{"properties":{"events":{"items":{"$ref":"#/components/schemas/EventInfo"},"type":"array","title":"Events"},"total":{"type":"integer","title":"Total"}},"type":"object","required":["events","total"],"title":"EventsResponse","description":"이벤트 목록 응답"},"EvidenceInfo":{"properties":{"ontology_paths":{"items":{"additionalProperties":true,"type":"object"},"type":"array","title":"Ontology Paths"},"document_refs":{"items":{"additionalProperties":true,"type":"object"},"type":"array","title":"Document Refs"},"similar_events":{"items":{"type":"string"},"type":"array","title":"Similar Events"}},"type":"object","title":"EvidenceInfo","description":"근거 정보"},"EvidenceResponse":{"properties":{"trace_id":{"type":"string","title":"Trace Id"},"found":{"type":"boolean","title":"Found"},"evidence":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Evidence"},"full_response":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Full Response"}},"type":"object","required":["trace_id","found"],"title":"EvidenceResponse","description":"근거 상세 응답"},"GraphData":{"properties":{"nodes":{"items":{"$ref":"#/components/schemas/GraphNode"},"type":"array","title":"Nodes"},"edges":{"items":{"$ref":"#/components/schemas/GraphEdge"},"type":"array","title":"Edges"}},"type":"object","title":"GraphData","description":"그래프 데이터"},"GraphEdge":{"properties":{"source":{"type":"string","title":"Source"},"target":{"type":"string","title":"Target"},"relation":{"type":"string","title":"Relation"}},"type":"object","required":["source","target","relation"],"title":"GraphEdge","description":"그래프 엣지"},"GraphNode":{"properties":{"id":{"type":"string","title":"Id"},"type":{"type":"string","title":"Type"},"label":{"type":"string","title":"Label"},"state":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"State"}},"type":"object","required":["id","type","label"],"title":"GraphNode","description":"그래프 노드"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HealthResponse":{"properties":{"status":{"type":"string","title":"Status"},"version":{"type":"string","title":"Version"},"components":{"additionalProperties":{"type":"string"},"type":"object","title":"Components"}},"type":"object","required":["status","version","components"],"title":"HealthResponse","description":"헬스체크 응답"},"PatternInfo":{"properties":{"id":{"type":"string","title":"Id"},"type":{"type":"string","title":"Type"},"timestamp":{"type":"string","title":"Timestamp"},"confidence":{"type":"number","title":"Confidence"},"metrics":{"additionalProperties":true,"type":"object","title":"Metrics"},"related_error_codes":{"items":{"type":"string"},"type":"array","title":"Related Error Codes"}},"type":"object","required":["id","type","timestamp","confidence","metrics"],"title":"PatternInfo","description":"패턴 정보"},"PatternsResponse":{"properties":{"patterns":{"items":{"$ref":"#/components/schemas/PatternInfo"},"type":"array","title":"Patterns"},"total":{"type":"integer","title":"Total"}},"type":"object","required":["patterns","total"],"title":"PatternsResponse","description":"패턴 목록 응답"},"PredictionInfo":{"properties":{"error_code":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Error Code"},"probability":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Probability"},"timeframe":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Timeframe"}},"type":"object","title":"PredictionInfo","description":"예측 정보"},"PredictionItem":{"properties":{"error_code":{"type":"string","title":"Error Code","description":"예측되는 에러 코드"},"probability":{"type":"number","title":"Probability","description":"발생 확률 (0.0 ~ 1.0)"},"pattern":{"type":"string","title":"Pattern","description":"감지된 패턴 ID"},"cause":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Cause","description":"추정 원인"},"timeframe":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Timeframe","description":"예상 발생 시점"},"recommendation":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Recommendation","description":"권장 조치"}},"type":"object","required":["error_code","probability","pattern"],"title":"PredictionItem","description":"단일 예측 결과"},"PredictionsResponse":{"properties":{"predictions":{"items":{"$ref":"#/components/schemas/RealtimePrediction"},"type":"array","title":"Predictions"},"total_patterns":{"type":"integer","title":"Total Patterns","description":"감지된 패턴 수"},"high_risk_count":{"type":"integer","title":"High Risk Count","description":"고위험 예측 수"}},"type":"object","required":["predictions","total_patterns","high_risk_count"],"title":"PredictionsResponse","description":"예측 응답"},"RealtimePrediction":{"properties":{"timestamp":{"type":"string","title":"Timestamp","description":"예측 시점"},"sensor_value":{"type":"number","title":"Sensor Value","description":"현재 센서 값 (Fz)"},"state":{"type":"string","title":"State","description":"현재 상태 (normal/warning/critical)"},"pattern_detected":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Pattern Detected","description":"감지된 패턴"},"predictions":{"items":{"$ref":"#/components/schemas/PredictionItem"},"type":"array","title":"Predictions","description":"예측 목록"},"ontology_path":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Ontology Path","description":"온톨로지 추론 경로"}},"type":"object","required":["timestamp","sensor_value","state"],"title":"RealtimePrediction","description":"실시간 예측 결과"},"ReasoningInfo":{"properties":{"confidence":{"type":"number","title":"Confidence"},"pattern":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Pattern"},"pattern_confidence":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Pattern Confidence"},"cause":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Cause"},"cause_confidence":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Cause Confidence"}},"type":"object","required":["confidence"],"title":"ReasoningInfo","description":"추론 정보"},"RecommendationInfo":{"properties":{"immediate":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Immediate"},"reference":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Reference"}},"type":"object","title":"RecommendationInfo","description":"권장사항"},"SensorReading":{"properties":{"timestamp":{"type":"string","title":"Timestamp"},"Fx":{"type":"number","title":"Fx"},"Fy":{"type":"number","title":"Fy"},"Fz":{"type":"number","title":"Fz"},"Tx":{"type":"number","title":"Tx"},"Ty":{"type":"number","title":"Ty"},"Tz":{"type":"number","title":"Tz"},"status":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Status","default":"normal"},"task_mode":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Task Mode","default":"idle"}},"type":"object","required":["timestamp","Fx","Fy","Fz","Tx","Ty","Tz"],"title":"SensorReading","description":"센서 측정값"},"SensorReadingsResponse":{"properties":{"readings":{"items":{"$ref":"#/components/schemas/SensorReading"},"type":"array","title":"Readings"},"total":{"type":"integer","title":"Total"},"time_range":{"additionalProperties":{"type":"string"},"type":"object","title":"Time Range"}},"type":"object","required":["readings","total","time_range"],"title":"SensorReadingsResponse","description":"센서 데이터 응답"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"}}}}