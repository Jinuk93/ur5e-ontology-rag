# UR5e Ontology-based Manufacturing AX System

> **Version**: 2.0
> **최종 수정**: 2026-01-22
> **문서 목적**: 온톨로지 기반 제조 AI 시스템 기술 설계서
> **참고 문서**: Axia80_센서_분석_보고서.md, UR5e_로봇_분석_보고서.md, 온톨로지_스키마_설계.md

---

## 목차

1. [프로젝트 개요](#1-프로젝트-개요)
2. [왜 온톨로지인가](#2-왜-온톨로지인가)
3. [팔란티어 스타일 접근](#3-팔란티어-스타일-접근)
4. [대상 장비](#4-대상-장비)
5. [시스템 아키텍처](#5-시스템-아키텍처)
6. [온톨로지 스키마](#6-온톨로지-스키마)
7. [질문 처리 방식](#7-질문-처리-방식)
8. [데이터 소스](#8-데이터-소스)
9. [기술 스택](#9-기술-스택)
10. [API 명세](#10-api-명세)
11. [UI/시각화](#11-ui시각화)
12. [평가 계획](#12-평가-계획)

---

# 1. 프로젝트 개요

## 1.1 프로젝트 정의

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│   UR5e Ontology-based Manufacturing AX System                           │
│   ═══════════════════════════════════════════                           │
│                                                                          │
│   "제조 현장의 복잡한 관계를 AI가 이해할 수 있게 하는 온톨로지 기반 시스템" │
│                                                                          │
│   • 단순 검색 시스템이 아님                                              │
│   • 관계 기반 추론 시스템                                                │
│   • 제조 AX(AI Transformation)의 핵심 인프라                            │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 1.2 프로젝트 목표

| 구분 | 목표 |
|------|------|
| **1차 목표** | 온톨로지 기반 제조 AI의 개념 증명 (PoC) |
| **2차 목표** | 팔란티어 스타일 관계 시각화 데모 |
| **3차 목표** | 룰베이스 → 온톨로지 기반 전환의 가치 입증 |

## 1.3 핵심 가치

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          Core Values                                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  1. 관계 기반 이해 (Relationship-based Understanding)                   │
│     → 데이터의 "의미"와 "관계"를 AI가 이해                              │
│     → 단순 키워드 매칭이 아닌 맥락 기반 추론                            │
│                                                                          │
│  2. 맥락 인식 (Context Awareness)                                       │
│     → 시간대, 제품, 작업자, 이력 반영                                   │
│     → "지금 이 상황에서" 무엇이 문제인지 판단                           │
│                                                                          │
│  3. 예측 가능성 (Predictability)                                        │
│     → 패턴 기반 사전 예측                                               │
│     → "내일 이 에러가 발생할 가능성이 높습니다"                         │
│                                                                          │
│  4. 근거 추적 (Traceability)                                            │
│     → 모든 답변에 근거 제시                                             │
│     → 온톨로지 경로 + 문서 출처 명시                                    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 1.4 프로젝트 범위

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          Scope                                           │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  [포함]                                                                  │
│  ✓ UR5e 협동로봇 1대                                                    │
│  ✓ ATI Axia80 힘/토크 센서 1대                                          │
│  ✓ 7일간의 시뮬레이션 센서 데이터                                        │
│  ✓ 공식 문서 3종 (User Manual, Service Manual, Error Codes)             │
│  ✓ 온톨로지 기반 질의응답 시스템                                        │
│  ✓ 관계 그래프 시각화 대시보드                                          │
│                                                                          │
│  [미포함 - 향후 확장]                                                    │
│  ✗ 다중 로봇 연동                                                       │
│  ✗ 실시간 센서 연동                                                      │
│  ✗ PLC/MES 연동                                                         │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 2. 왜 온톨로지인가

## 2.1 현재의 문제: 룰베이스 시스템의 한계

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     현재: 룰베이스 (Rule-based)                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   전형적인 제조 현장 모니터링:                                           │
│                                                                          │
│   IF Fz > 500N THEN alert("과부하")                                     │
│   IF error_code == "C153" THEN show("장애물 제거하세요")                │
│   IF temperature > 80 THEN warning("과열")                              │
│                                                                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │ 장점                          │ 한계                            │   │
│   │ ───────────────────────────────────────────────────────────────│   │
│   │ ✓ 단순하고 빠름               │ ✗ 사전 정의된 조건만 처리      │   │
│   │ ✓ 예측 가능한 동작            │ ✗ 맥락/관계 이해 불가          │   │
│   │ ✓ 구현 비용 낮음              │ ✗ 새로운 상황 대응 불가        │   │
│   │                               │ ✗ "왜?"에 답할 수 없음         │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│   예시: "Fz가 350N이야"                                                 │
│   룰베이스 응답: "정상 범위 초과" (끝)                                   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 2.2 미래의 해결책: 온톨로지 기반 시스템

```
┌─────────────────────────────────────────────────────────────────────────┐
│                     미래: 온톨로지 기반 (Ontology-based)                 │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   예시: "Fz가 350N이야"                                                 │
│                                                                          │
│   온톨로지 추론 과정:                                                    │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │ 1. 엔티티 인식                                                  │   │
│   │    → Fz는 Axia80 센서의 Z축 힘 측정값                          │   │
│   │    → 정상 범위: -60N ~ 0N (IDLE 상태)                          │   │
│   │    → 350N은 정상의 약 6배                                       │   │
│   │                                                                  │   │
│   │ 2. 현재 맥락 분석                                                │   │
│   │    → 시간: 14:30 (B조 근무)                                      │   │
│   │    → 제품: PART-C (4.2kg, 페이로드 상한 근접)                   │   │
│   │    → 작업: pick 단계                                             │   │
│   │                                                                  │   │
│   │ 3. 이력 패턴 매칭                                                │   │
│   │    → 유사 사례: EVT-003, EVT-004, EVT-005 (3일 연속)           │   │
│   │    → 모두 14시대, PART-C, B조에서 발생                         │   │
│   │    → 4일차에 C189 에러 발생 (EVT-006)                          │   │
│   │                                                                  │   │
│   │ 4. 관계 기반 원인 추론                                           │   │
│   │    → 350N + PART-C + 패턴 반복 → CAUSE_GRIP_POSITION (85%)     │   │
│   │    → 그립 위치 불량으로 무게 중심 편향 추정                     │   │
│   │                                                                  │   │
│   │ 5. 예측                                                          │   │
│   │    → 조치 없으면 24시간 내 C189 발생 확률 85%                   │   │
│   │                                                                  │   │
│   │ 6. 권장 조치 (문서 근거 포함)                                    │   │
│   │    → 즉시: 그립 위치 확인                                        │   │
│   │    → 참고: Service Manual p.45                                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 2.3 비교 요약

| 항목 | 룰베이스 | 온톨로지 기반 |
|------|----------|--------------|
| **질문** | "Fz가 350N이야" | 동일 |
| **응답** | "정상 범위 초과" | "그립 위치 불량 추정, 내일 C189 가능성 85%" |
| **맥락 이해** | 없음 | 시간, 제품, 이력 반영 |
| **원인 추론** | 불가 | 관계 기반 추론 |
| **예측** | 불가 | 패턴 기반 예측 |
| **근거** | 없음 | 온톨로지 경로 + 문서 출처 |

## 2.4 제조 AX 관점

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    Manufacturing AX (AI Transformation)                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   현재                        미래                                       │
│   ════                        ════                                       │
│   룰베이스 알람     ──────▶   온톨로지 기반 AI                          │
│   IF-THEN 조건               관계 기반 추론                             │
│   단일 장비 모니터링         다중 장비 상호작용 이해                    │
│   사후 대응                   예측 및 예방                               │
│                                                                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                                                                  │   │
│   │   [로봇1] ──→ [센서A] ──→ [품질검사]                            │   │
│   │      ↑                         │                                 │   │
│   │      └──── [PLC] ←─────────────┘                                │   │
│   │              ↑                                                   │   │
│   │   [로봇2] ──→ [센서B] ───┘                                      │   │
│   │                                                                  │   │
│   │   온톨로지가 이 모든 관계를 정의                                 │   │
│   │   → "센서A 이상 시 영향받는 것은?"                              │   │
│   │   → AI가 전체 시스템을 이해하고 추론 가능                       │   │
│   │                                                                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│   우리 프로젝트 = 이 미래의 "개념 증명(PoC)"                            │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 3. 팔란티어 스타일 접근

## 3.1 팔란티어 Foundry란?

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       Palantir Foundry                                   │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   세계 최고의 데이터 통합/분석 플랫폼                                    │
│                                                                          │
│   핵심 철학:                                                             │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                                                                  │   │
│   │  "데이터를 통합하고, 관계를 정의하고,                           │   │
│   │   인간이 이해할 수 있는 형태로 시각화한다"                       │   │
│   │                                                                  │   │
│   │  1. 이기종 데이터 통합                                          │   │
│   │     → 수백 개의 다른 소스를 하나로                              │   │
│   │                                                                  │   │
│   │  2. 온톨로지 기반 관계 정의                                      │   │
│   │     → 데이터 간 의미적 연결                                      │   │
│   │                                                                  │   │
│   │  3. 시각적 그래프 탐색                                           │   │
│   │     → 클릭으로 관계 탐색                                         │   │
│   │                                                                  │   │
│   │  4. 맥락 기반 분석                                               │   │
│   │     → 전체 그림에서 인사이트 도출                                │   │
│   │                                                                  │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 3.2 우리 프로젝트에의 적용

| 팔란티어 핵심 | 우리 프로젝트 적용 |
|--------------|-------------------|
| **이기종 데이터 통합** | Axia80 센서 + UR5e 로봇 + 문서 3종 |
| **온톨로지 기반 관계** | 4-Domain (Equipment, Measurement, Knowledge, Context) |
| **시각적 그래프 탐색** | 관계 그래프 UI (D3.js) |
| **맥락 기반 분석** | 시간대, 제품, 작업자 컨텍스트 반영 |

## 3.3 규모 비교

| 항목 | 팔란티어 Foundry | 우리 프로젝트 |
|------|-----------------|--------------|
| **규모** | 엔터프라이즈 | 소규모 데모 |
| **데이터 소스** | 수백~수천 개 | 5개 (센서1, 로봇1, 문서3) |
| **온톨로지 노드** | 수만~수십만 | ~50개 |
| **관계** | 수백만 | ~100개 |
| **목표** | 실제 운영 | 개념 증명 (PoC) |
| **핵심 가치** | **동일**: 관계 기반 데이터 이해 및 추론 |

---

# 4. 대상 장비

## 4.1 UR5e 협동로봇

### 선정 이유
1. 공식 문서 완전성: Service Manual, Error Codes Directory 공개
2. 글로벌 시장 점유율: 협동로봇 시장 Top 3
3. 표준화된 인터페이스: PolyScope 기반 일관된 문서 체계

### 사양 요약
| 항목 | 값 |
|------|-----|
| 가반하중 | 5 kg |
| 작업반경 | 850 mm |
| 관절 수 | 6축 |
| 반복정밀도 | ±0.03 mm |
| 컨트롤러 | e-Series Control Box |

### 온톨로지 관점
```yaml
UR5e:
  type: "Collaborative Robot"
  has_components:
    - ControlBox
    - RobotArm (6 Joints)
    - TeachPendant
  generates_errors:
    - C153 (Safety System Violation)
    - C189 (Payload Exceeded)
    - C119 (Protective Stop)
```

## 4.2 ATI Axia80 힘/토크 센서

### 선정 이유
1. UR+ 인증: UR 로봇과 공식 호환
2. 현장 활용도: 조립, 삽입, 연마 등 접촉 작업에 필수
3. 풍부한 진단 정보: 6축 힘/토크로 충돌, 마모, 오정렬 감지

### 사양 요약
| 항목 | 값 |
|------|-----|
| 측정축 | 6축 (Fx, Fy, Fz, Tx, Ty, Tz) |
| 힘 범위 | Fz: ±235N, Fx/Fy: ±75N |
| 토크 범위 | ±4 Nm |
| 샘플링 레이트 | 최대 7,200 Hz (운영: 125 Hz) |
| 장착 위치 | UR5e Tool Flange |

### 온톨로지 관점
```yaml
Axia80:
  type: "Force/Torque Sensor"
  mounted_on: UR5e.ToolFlange
  measures:
    - Fz (primary, vertical force)
    - Fx, Fy (horizontal forces)
    - Tx, Ty, Tz (torques)
  detects_patterns:
    - PAT_COLLISION
    - PAT_OVERLOAD
    - PAT_VIBRATION
    - PAT_DRIFT
```

---

# 5. 시스템 아키텍처

## 5.1 설계 원칙

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          Design Principles                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  1. Ontology-first (온톨로지 우선)                                      │
│     → 모든 데이터는 온톨로지 관계로 연결                                │
│     → 검색 전에 관계 탐색                                               │
│                                                                          │
│  2. Context-aware (맥락 인식)                                           │
│     → 질문만이 아닌 현재 상황 전체 고려                                 │
│     → 시간, 제품, 이력 반영                                             │
│                                                                          │
│  3. Evidence-based (근거 기반)                                          │
│     → 모든 답변에 근거 명시                                             │
│     → 온톨로지 경로 + 문서 출처                                         │
│                                                                          │
│  4. Palantir-style (팔란티어 스타일)                                    │
│     → 관계 그래프 시각화                                                │
│     → 클릭으로 탐색 가능                                                │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 5.2 전체 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    UR5e Ontology-based Manufacturing AX                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌────────────────┐                                                     │
│  │   사용자 질문   │   "Fz가 350N인데 이게 뭐야?"                       │
│  └───────┬────────┘                                                     │
│          │                                                              │
│          ▼                                                              │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │                    Query Classifier                            │     │
│  │                                                                │     │
│  │   질문 유형 분류:                                              │     │
│  │   • 온톨로지성 질문 (관계/맥락 추론 필요)                      │     │
│  │   • 하이브리드 질문 (온톨로지 + 문서)                          │     │
│  │   • 일반 RAG 질문 (문서 검색만)                                │     │
│  └───────┬───────────────────────────────────────┬───────────────┘     │
│          │                                       │                      │
│          ▼                                       ▼                      │
│  ┌───────────────────────┐              ┌───────────────────────┐      │
│  │   Ontology Engine     │              │   Vector Search       │      │
│  │   ═══════════════     │              │   ═════════════       │      │
│  │                       │              │                       │      │
│  │ • 엔티티 인식         │              │ • 문서 청크 검색      │      │
│  │   "Fz" → Axia80.Fz    │              │ • 유사도 기반 매칭    │      │
│  │                       │              │                       │      │
│  │ • 관계 탐색           │              │                       │      │
│  │   Fz → 상태 → 패턴    │              │                       │      │
│  │   → 원인 → 해결책     │              │                       │      │
│  │                       │              │                       │      │
│  │ • 맥락 로딩           │              │                       │      │
│  │   시간, 제품, 이력    │              │                       │      │
│  │                       │              │                       │      │
│  │ • 규칙 기반 추론      │              │                       │      │
│  │   패턴 매칭, 예측     │              │                       │      │
│  └───────┬───────────────┘              └───────────┬───────────┘      │
│          │                                          │                   │
│          └───────────────────┬──────────────────────┘                   │
│                              │                                          │
│                              ▼                                          │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │                      LLM (추론 엔진)                           │     │
│  │                                                                │     │
│  │   온톨로지 관계 + 문서 컨텍스트 + 맥락                         │     │
│  │              ↓                                                 │     │
│  │   통합 추론 → 자연어 응답 생성                                 │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                              │                                          │
│                              ▼                                          │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │                      Response                                  │     │
│  │                                                                │     │
│  │   • 구조화된 분석 결과 (원인, 예측, 권장 조치)                 │     │
│  │   • 자연어 설명                                                │     │
│  │   • 관계 그래프 시각화 (팔란티어 스타일)                       │     │
│  │   • 근거 (온톨로지 경로 + 문서 출처)                          │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 5.3 온톨로지 vs LLM 역할 분담

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│   [온톨로지]                              [LLM]                         │
│   ═══════════                            ═══════                        │
│   관계 데이터 (What)                     추론 엔진 (How)                │
│                                                                          │
│   ┌─────────────────────────┐           ┌─────────────────────────┐    │
│   │ • 엔티티 정의           │           │ • 자연어 이해           │    │
│   │   "Axia80은 센서다"     │           │   "Fz가 뭐야?" 해석     │    │
│   │                         │           │                         │    │
│   │ • 관계 정의             │           │ • 온톨로지 기반 추론    │    │
│   │   "Axia80 → UR5e 장착"  │           │   여러 관계 조합 분석   │    │
│   │                         │           │                         │    │
│   │ • 속성/범위 정의        │           │ • 자연어 응답 생성      │    │
│   │   "Fz 정상: -60~0N"     │           │   사람이 이해하기 쉽게  │    │
│   │                         │           │                         │    │
│   │ • 규칙 정의             │           │ • 맥락 통합             │    │
│   │   "Fz>500N/100ms=충돌"  │           │   여러 정보 종합 판단   │    │
│   └─────────────────────────┘           └─────────────────────────┘    │
│              │                                     │                    │
│              │     "무엇이 무엇과                  │                    │
│              │      어떻게 연결되어 있는가"        │                    │
│              │                                     │                    │
│              └─────────────┬───────────────────────┘                    │
│                            │                                            │
│                            ▼                                            │
│              ┌─────────────────────────────────┐                        │
│              │  "그래서 이 상황은 무엇이고,    │                        │
│              │   어떻게 해야 하는가"           │                        │
│              └─────────────────────────────────┘                        │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 5.4 데이터 흐름

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          Data Flow                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  [OFFLINE - 배치 처리]                                                  │
│                                                                          │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │
│  │ Axia80 센서  │  │  UR5e 로봇   │  │  문서 (PDF)  │                  │
│  │ (7일 데이터) │  │  (에러로그)  │  │ (722 chunks) │                  │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘                  │
│         │                 │                 │                           │
│         ▼                 ▼                 ▼                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │
│  │ 패턴 감지    │  │ 이벤트 추출  │  │ 벡터 임베딩  │                  │
│  │ 17개 패턴    │  │ 10개 이벤트  │  │ ChromaDB     │                  │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘                  │
│         │                 │                 │                           │
│         └────────────────┬┴─────────────────┘                           │
│                          │                                              │
│                          ▼                                              │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │                    Ontology Layer                              │     │
│  │                                                                │     │
│  │  ┌───────────┐  ┌───────────┐  ┌───────────┐  ┌───────────┐  │     │
│  │  │ Equipment │◀─▶Measurement│◀─▶│ Knowledge │◀─▶│  Context  │  │     │
│  │  └───────────┘  └───────────┘  └───────────┘  └───────────┘  │     │
│  │                                                                │     │
│  │  ~50 Entities, ~100 Relationships, ~20 Rules                  │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                                                                          │
│  [ONLINE - 실시간 서빙]                                                 │
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │  사용자 질문 → 분류 → 온톨로지/벡터 → LLM → 응답 + 그래프     │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 6. 온톨로지 스키마

## 6.1 4-Domain 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        UR5e Ontology Domains                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐   │
│  │                   │  │                   │  │                   │   │
│  │    Equipment      │  │   Measurement     │  │    Knowledge      │   │
│  │    Domain         │◀─▶    Domain         │◀─▶    Domain         │   │
│  │                   │  │                   │  │                   │   │
│  │   물리적 장비     │  │   센서/측정       │  │   문제해결 지식   │   │
│  │                   │  │                   │  │                   │   │
│  └───────────────────┘  └───────────────────┘  └───────────────────┘   │
│           │                     │                     │                 │
│           ▼                     ▼                     ▼                 │
│  ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐   │
│  │ • UR5e Robot      │  │ • Axia80 Sensor   │  │ • Error Codes     │   │
│  │ • Joints (0-5)    │  │ • Axes (Fx~Tz)    │  │ • Causes          │   │
│  │ • Control Box     │  │ • States          │  │ • Resolutions     │   │
│  │ • Tool Flange     │  │ • Patterns        │  │ • Documents       │   │
│  │ • Gripper         │  │ • Thresholds      │  │ • Procedures      │   │
│  └───────────────────┘  └───────────────────┘  └───────────────────┘   │
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    Context Domain (운영 컨텍스트)                  │  │
│  │                                                                   │  │
│  │   • Shifts (A/B/C조)  • Products (PART-A/B/C)  • Operators       │  │
│  │   • Work Cycles       • Time Patterns         • Historical Data  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 6.2 주요 엔티티

### Equipment Domain
| Entity | 설명 | 인스턴스 |
|--------|------|----------|
| Robot | 협동로봇 | UR5e |
| Joint | 로봇 관절 | Joint_0 ~ Joint_5 |
| ControlBox | 제어박스 | CB_UR5e |
| ToolFlange | 툴 플랜지 | TF_UR5e |

### Measurement Domain
| Entity | 설명 | 인스턴스 |
|--------|------|----------|
| Sensor | 센서 | Axia80 |
| MeasurementAxis | 측정축 | Fx, Fy, Fz, Tx, Ty, Tz |
| State | 상태 | IDLE, NORMAL_LOAD, WARNING, CRITICAL |
| Pattern | 이상패턴 | PAT_COLLISION, PAT_OVERLOAD, PAT_VIBRATION, PAT_DRIFT |

### Knowledge Domain
| Entity | 설명 | 인스턴스 |
|--------|------|----------|
| ErrorCode | 에러코드 | C153, C189, C119 |
| Cause | 원인 | CAUSE_PHYSICAL_CONTACT, CAUSE_PAYLOAD_EXCEEDED |
| Resolution | 해결책 | RES_CLEAR_OBSTRUCTION, RES_REDUCE_PAYLOAD |
| Document | 문서 | UserManual, ServiceManual, ErrorCodes |

### Context Domain
| Entity | 설명 | 인스턴스 |
|--------|------|----------|
| Shift | 근무조 | SHIFT_A, SHIFT_B, SHIFT_C |
| Product | 제품 | PART-A, PART-B, PART-C |
| WorkCycle | 작업단계 | idle, approach, pick, retract, place |

## 6.3 관계 타입

| 관계 | Source → Target | 설명 |
|------|-----------------|------|
| **HAS_COMPONENT** | UR5e → Joint | 장비 계층 |
| **MOUNTED_ON** | Axia80 → ToolFlange | 센서 장착 |
| **MEASURES** | Axia80 → Fz | 측정 대상 |
| **HAS_STATE** | Fz → NORMAL_LOAD | 상태 보유 |
| **INDICATES** | PAT_COLLISION → CAUSE | 패턴→원인 |
| **TRIGGERS** | PAT_COLLISION → C153 | 패턴→에러 |
| **CAUSED_BY** | C153 → CAUSE | 에러→원인 |
| **RESOLVED_BY** | CAUSE → Resolution | 원인→해결 |
| **DOCUMENTED_IN** | C153 → Document | 문서 참조 |
| **OCCURS_DURING** | Event → Shift | 발생 시간 |
| **INVOLVES** | Event → Product | 관련 제품 |

## 6.4 관계 그래프 예시

```
[UR5e] ──HAS_COMPONENT──→ [Joint_5] ──HAS_COMPONENT──→ [ToolFlange]
                                                            │
                                                       MOUNTED_ON
                                                            │
                                                            ▼
                                                       [Axia80]
                                                            │
                                                        MEASURES
                                    ┌───────────────────────┼───────────────────────┐
                                    ▼                       ▼                       ▼
                                  [Fx]                    [Fz]                    [Tx]
                                                           │
                                                       HAS_STATE
                                    ┌──────────────────────┼──────────────────────┐
                                    ▼                      ▼                      ▼
                               [NORMAL]              [WARNING]              [CRITICAL]
                                                          │                      │
                                                      INDICATES              INDICATES
                                                          │                      │
                                                          ▼                      ▼
                                                   [PAT_OVERLOAD]         [PAT_COLLISION]
                                                          │                      │
                                                      TRIGGERS               TRIGGERS
                                                          │                      │
                                                          ▼                      ▼
                                                       [C189]                 [C153]
                                                          │                      │
                                                     RESOLVED_BY            RESOLVED_BY
                                                          │                      │
                                                          ▼                      ▼
                                                 [RES_REDUCE_PAYLOAD]  [RES_CLEAR_OBSTRUCTION]
```

---

# 7. 질문 처리 방식

## 7.1 질문 분류

| 유형 | 예시 | 특징 | 처리 방식 |
|------|------|------|----------|
| **온톨로지성** | "Fz가 350N인데 이게 뭐야?" | 관계/맥락 추론 필요 | Ontology Engine 중심 |
| **하이브리드** | "C153이 자주 발생하는 이유?" | 온톨로지 + 문서 | 양쪽 병합 |
| **일반 RAG** | "UR5e 페이로드가 몇 kg?" | 단순 정보 조회 | Vector Search 중심 |

## 7.2 온톨로지성 질문 처리 (핵심 차별화)

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    온톨로지성 질문 처리 파이프라인                        │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  입력: "Fz가 350N인데 이게 뭐야?"                                       │
│                                                                          │
│  Step 1: 엔티티 인식                                                    │
│  ─────────────────                                                      │
│  → "Fz" → Axia80.Fz (Z축 힘)                                           │
│  → "350N" → 수치값                                                      │
│                                                                          │
│  Step 2: 온톨로지 컨텍스트 로딩                                         │
│  ──────────────────────────                                             │
│  → Fz.normal_range = [-60N, 0N]                                         │
│  → Fz.states = {IDLE, LIGHT_LOAD, NORMAL_LOAD, ...}                    │
│  → 350N = 정상 범위의 약 6배 → CRITICAL                                │
│                                                                          │
│  Step 3: 현재 맥락 분석                                                  │
│  ────────────────────                                                   │
│  → 시간: 14:30 → SHIFT_B                                                │
│  → 제품: PART-C (4.2kg)                                                 │
│  → 작업: pick 단계                                                       │
│                                                                          │
│  Step 4: 이력 패턴 매칭                                                  │
│  ────────────────────                                                   │
│  → 유사 이벤트: EVT-003, EVT-004, EVT-005                              │
│  → 공통점: 14시대, PART-C, B조                                         │
│  → 4일차 C189 발생 (EVT-006)                                           │
│                                                                          │
│  Step 5: 관계 탐색 (Ontology Path)                                      │
│  ──────────────────────────────                                         │
│  → Fz(350N) → CRITICAL → PAT_OVERLOAD → CAUSE_GRIP_POSITION           │
│  → CAUSE_GRIP_POSITION → RES_ADJUST_GRIP_POSITION                      │
│  → PAT_OVERLOAD → TRIGGERS → C189                                      │
│                                                                          │
│  Step 6: 예측                                                            │
│  ─────────                                                              │
│  → 3일 연속 패턴 + 동일 조건 → 내일 C189 확률 85%                      │
│                                                                          │
│  Step 7: 응답 생성                                                       │
│  ───────────────                                                        │
│  → 구조화된 분석 + 자연어 설명 + 관계 그래프 + 근거                    │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 7.3 응답 구조

```json
{
  "trace_id": "uuid",
  "query_type": "ontology",

  "analysis": {
    "entity": "Fz",
    "value": 350,
    "normal_range": [-60, 0],
    "state": "CRITICAL",
    "deviation": "정상 대비 약 6배"
  },

  "context": {
    "shift": "B (14:00-22:00)",
    "product": "PART-C (4.2kg)",
    "work_phase": "pick"
  },

  "reasoning": {
    "pattern": "PAT_OVERLOAD",
    "cause": "CAUSE_GRIP_POSITION",
    "confidence": 0.85,
    "similar_events": ["EVT-003", "EVT-004", "EVT-005"]
  },

  "prediction": {
    "error_code": "C189",
    "probability": 0.85,
    "timeframe": "24시간 내"
  },

  "recommendation": {
    "immediate": "그립 위치 확인",
    "short_term": "PART-C 작업 SOP 검토",
    "reference": "Service Manual p.45"
  },

  "evidence": {
    "ontology_path": "Fz → CRITICAL → PAT_OVERLOAD → C189",
    "document_refs": [
      {"doc_id": "service_manual", "page": 45, "chunk_id": "SM-045-01"}
    ]
  },

  "abstain": false,
  "abstain_reason": null,

  "graph": {
    "nodes": [...],
    "edges": [...]
  }
}
```

## 7.4 일반 RAG 질문과의 비교

| 항목 | 일반 RAG | 온톨로지 기반 |
|------|----------|--------------|
| **질문** | "UR5e 페이로드?" | "Fz가 350N인데?" |
| **처리** | 문서 검색 → 답변 | 관계 추론 → 맥락 분석 → 예측 |
| **응답** | "5kg입니다" | 구조화된 분석 + 예측 + 권장 |
| **근거** | 문서 출처 | 온톨로지 경로 + 문서 |
| **시각화** | 없음 | 관계 그래프 |

---

# 8. 데이터 소스

## 8.1 문서 데이터

### 문서 목록
| doc_id | 문서명 | 용도 | 청크 수 |
|--------|--------|------|---------|
| `user_manual` | UR5e User Manual | 운영/안전 지침 | 426 |
| `service_manual` | UR e-Series Service Manual | 수리/점검 절차 | 197 |
| `error_codes` | Error Codes Directory | 에러코드 → 조치 매핑 | 99 |
| **합계** | - | - | **722** |

### 온톨로지 연결
```yaml
Document:
  instances:
    - id: "user_manual"
      topics: [safety, operation, installation]
      linked_errors: [C10, C11, ...]

    - id: "service_manual"
      topics: [maintenance, repair, troubleshooting]
      linked_errors: [C153, C189, ...]
```

## 8.2 센서 데이터

### ATI Axia80 시뮬레이션 데이터
| 항목 | 값 |
|------|-----|
| 기간 | 7일 (2024-01-15 ~ 2024-01-21) |
| 샘플링 | 125 Hz (Axia80 최대 7.2kHz, 운영 주파수 사용) |
| 레코드 수 | 604,800개 |
| 파일 크기 | 34.15 MB |
| 저장 형식 | Parquet |

### 데이터 저장 전략 (관측가능성 확보)

| 계층 | 샘플링 | 용도 | 비고 |
|------|--------|------|------|
| **Baseline** | 1Hz 평균 | 장기 트렌드, 대시보드 | 604,800 레코드/7일 |
| **Event Snippet** | 125Hz 원본 | 패턴 근거 제시 | 이벤트 구간 ±5초 |
| **Feature Summary** | 이벤트별 | 추론 근거 (trace) | delta_Fz, rise_time 등 |

**설계 근거**: 100ms 패턴(충돌)을 "관측 가능한 근거"로 제시하려면 1Hz 평균만으로는 불가능. 이벤트 구간에 125Hz 스니펫 또는 feature summary를 저장해야 "왜 collision인지" 숫자로 설명 가능.

### 감지된 이벤트/패턴
| 이벤트 유형 | 개수 | 예시 |
|-------------|------|------|
| Collision | 2 | EVT-001, EVT-002 |
| Overload | 4 | EVT-003 ~ EVT-006 |
| Tool Change | 2 | EVT-007, EVT-008 |
| Recalibration | 1 | EVT-009 |
| Drift (no doc) | 1 | EVT-010 |
| **합계** | **10** | - |

### 감지된 패턴
| 패턴 유형 | 개수 |
|-----------|------|
| Collision | 2 |
| Overload | 4 |
| Drift | 11 |
| **합계** | **17** |

---

# 9. 기술 스택

## 9.1 스택 개요

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          Technology Stack                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  Frontend (팔란티어 스타일 UI)                                    │  │
│  │  • Streamlit (빠른 프로토타이핑)                                  │  │
│  │  • D3.js (관계 그래프 시각화)                                     │  │
│  │  • Plotly (센서 차트)                                             │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                              │                                           │
│                              ▼                                           │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  Backend (API Server)                                             │  │
│  │  • FastAPI                                                        │  │
│  │  • Python 3.10+                                                   │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                              │                                           │
│           ┌──────────────────┼──────────────────┐                       │
│           ▼                  ▼                  ▼                       │
│  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐           │
│  │ Ontology Store  │ │  Vector Store   │ │  Sensor Store   │           │
│  │ (JSON/YAML)     │ │  (ChromaDB)     │ │  (Parquet)      │           │
│  └─────────────────┘ └─────────────────┘ └─────────────────┘           │
│                              │                                           │
│                              ▼                                           │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  AI/ML                                                            │  │
│  │  • OpenAI GPT-4 (추론/생성)                                       │  │
│  │  • text-embedding-3-small (임베딩)                                │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 9.2 기술 선택 이유

| 레이어 | 기술 | 선택 이유 |
|--------|------|----------|
| **Ontology** | JSON/YAML | 간단, 버전 관리 용이, 빠른 수정 |
| **Vector DB** | ChromaDB | 로컬 실행, 빠른 프로토타이핑 |
| **Sensor Store** | Parquet | 컬럼 기반, 빠른 조회 |
| **Backend** | FastAPI | 비동기, 자동 문서화 |
| **Frontend** | Streamlit | 빠른 UI 개발 |
| **Graph Viz** | D3.js | 유연한 그래프 시각화 |
| **LLM** | GPT-4 | 최고 수준의 추론 능력 |

## 9.3 의존성

```
# Core
python>=3.10
fastapi>=0.100.0
uvicorn>=0.23.0
streamlit>=1.40.0

# Database
chromadb>=0.4.0

# AI/ML
openai>=1.0.0
langchain>=0.1.0

# Data Processing
pandas>=2.0.0
pyarrow>=14.0.0
pyyaml>=6.0

# Visualization
plotly>=5.18.0
```

---

# 10. API 명세

## 10.1 엔드포인트 목록

| Method | Path | 설명 |
|--------|------|------|
| POST | `/api/v1/query` | 질의응답 (메인) |
| GET | `/api/v1/ontology/entity/{id}` | 엔티티 상세 조회 |
| GET | `/api/v1/ontology/relations/{id}` | 관계 탐색 |
| GET | `/api/v1/sensor/current` | 현재 센서 상태 |
| GET | `/api/v1/sensor/patterns` | 감지된 패턴 |
| GET | `/api/v1/evidence/{trace_id}` | 근거 상세 조회 |
| GET | `/api/v1/health` | 상태 점검 |

## 10.2 POST /api/v1/query

### Request
```json
{
  "query": "Fz가 350N인데 이게 뭐야?",
  "context": {
    "current_time": "2024-01-17T14:30:00",
    "product": "PART-C"
  },
  "options": {
    "include_graph": true,
    "include_prediction": true
  }
}
```

### Response
```json
{
  "trace_id": "550e8400-e29b-41d4-a716-446655440000",
  "query_type": "ontology",

  "answer": "Fz 350N은 정상 범위(-60N~0N)를 크게 초과한 CRITICAL 상태입니다...",

  "analysis": {
    "entity": "Fz",
    "value": 350,
    "state": "CRITICAL",
    "pattern": "PAT_OVERLOAD"
  },

  "reasoning": {
    "cause": "CAUSE_GRIP_POSITION",
    "confidence": 0.85,
    "ontology_path": "Fz → CRITICAL → PAT_OVERLOAD → CAUSE_GRIP_POSITION"
  },

  "prediction": {
    "error_code": "C189",
    "probability": 0.85,
    "timeframe": "24시간 내"
  },

  "recommendation": {
    "immediate": "그립 위치 확인",
    "reference": "Service Manual p.45"
  },

  "evidence": {
    "document_refs": [
      {"doc_id": "service_manual", "page": 45, "chunk_id": "SM-045-01"}
    ],
    "similar_events": ["EVT-003", "EVT-004", "EVT-005"]
  },

  "abstain": false,
  "abstain_reason": null,

  "graph": {
    "nodes": [
      {"id": "Fz", "type": "MeasurementAxis", "label": "Fz (350N)"},
      {"id": "PAT_OVERLOAD", "type": "Pattern", "label": "과부하"},
      {"id": "C189", "type": "ErrorCode", "label": "C189"}
    ],
    "edges": [
      {"source": "Fz", "target": "PAT_OVERLOAD", "relation": "INDICATES"},
      {"source": "PAT_OVERLOAD", "target": "C189", "relation": "TRIGGERS"}
    ]
  }
}
```

## 10.3 GET /api/v1/ontology/entity/{id}

### Response
```json
{
  "entity": {
    "id": "Fz",
    "type": "MeasurementAxis",
    "properties": {
      "direction": "Z (vertical)",
      "unit": "N",
      "range": [-235, 235],
      "normal_range": [-60, 0]
    }
  },
  "relationships": [
    {"relation": "MEASURED_BY", "target": "Axia80"},
    {"relation": "HAS_STATE", "targets": ["IDLE", "NORMAL_LOAD", "WARNING", "CRITICAL"]},
    {"relation": "INDICATES", "targets": ["PAT_COLLISION", "PAT_OVERLOAD"]}
  ]
}
```

---

# 11. UI/시각화

## 11.1 팔란티어 스타일 대시보드 (개념)

```
┌─────────────────────────────────────────────────────────────────────────┐
│  UR5e Ontology Dashboard                              [Settings] [Help] │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────────────┐  ┌────────────────────────────────────────┐  │
│  │  📊 Real-time Status │  │  💬 Query Interface                     │  │
│  │                      │  │                                         │  │
│  │  Fz: -52N  ✓        │  │  ┌─────────────────────────────────┐   │  │
│  │  Fx: 2.1N  ✓        │  │  │ "Fz가 350N인데 이게 뭐야?"      │   │  │
│  │  Tx: 0.1Nm ✓        │  │  └─────────────────────────────────┘   │  │
│  │                      │  │                              [Ask] ▶   │  │
│  │  Status: ● NORMAL    │  │                                         │  │
│  │  Shift: B (14:00~)   │  │  ┌─────────────────────────────────┐   │  │
│  │  Product: PART-C     │  │  │ 📝 Answer                       │   │  │
│  │                      │  │  │                                 │   │  │
│  └──────────────────────┘  │  │ Fz 350N은 CRITICAL 상태입니다.  │   │  │
│                            │  │ 그립 위치 불량으로 추정되며,    │   │  │
│                            │  │ 24시간 내 C189 발생 확률 85%    │   │  │
│                            │  │                                 │   │  │
│                            │  │ 권장: 그립 위치 확인            │   │  │
│                            │  └─────────────────────────────────┘   │  │
│                            └────────────────────────────────────────┘  │
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  🔗 Knowledge Graph                                               │  │
│  │                                                                    │  │
│  │      [UR5e] ─── [Axia80] ─── [Fz] ─── [OVERLOAD] ─── [C189]      │  │
│  │                              ↑ ↑                                  │  │
│  │                          350N  Selected                           │  │
│  │                                                                    │  │
│  │  Click any node to explore relationships                          │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  📈 Sensor Timeline (Last 7 Days)                                 │  │
│  │     ┌───────────────────────────────────────────────────────┐    │  │
│  │  Fz │   ●EVT-001          ●EVT-002                           │    │  │
│  │     │  ●────●────●────●────●────●────●                      │    │  │
│  │     └───────────────────────────────────────────────────────┘    │  │
│  │       Jan-15  16  17  18  19  20  21                              │  │
│  │                                                                    │  │
│  │  ● Collision  ● Overload  ● Drift                                │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 11.2 주요 UI 컴포넌트

| 컴포넌트 | 설명 | 기술 |
|----------|------|------|
| **Query Interface** | 질문 입력/답변 표시 | Streamlit |
| **Knowledge Graph** | 관계 그래프 시각화, 클릭 탐색 | D3.js |
| **Sensor Timeline** | 센서 데이터 + 이벤트 타임라인 | Plotly |
| **Real-time Status** | 현재 센서 상태/맥락 | Streamlit |
| **Evidence Panel** | 근거 (온톨로지 경로 + 문서) | Streamlit |

## 11.3 그래프 인터랙션

```
┌─────────────────────────────────────────────────────────────────────────┐
│                       Graph Interaction                                  │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  [노드 클릭]                                                            │
│  ───────────                                                            │
│  → 해당 엔티티 상세 정보 표시                                           │
│  → 연결된 관계 하이라이트                                               │
│  → 관련 문서 링크 제공                                                  │
│                                                                          │
│  [관계 클릭]                                                            │
│  ───────────                                                            │
│  → 관계 의미 설명                                                       │
│  → 해당 관계의 다른 예시 표시                                           │
│                                                                          │
│  [Expand/Collapse]                                                      │
│  ─────────────────                                                      │
│  → 노드 더블클릭 시 하위 관계 확장/축소                                 │
│                                                                          │
│  [Search/Filter]                                                        │
│  ───────────────                                                        │
│  → 특정 엔티티/관계 타입 필터링                                         │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 12. 평가 계획

## 12.1 평가 축

| 축 | 측정 대상 | 의미 |
|----|----------|------|
| **Ontology Reasoning** | 관계 추론 정확도 | 온톨로지 경로가 올바른가? |
| **Context Awareness** | 맥락 반영 정도 | 시간/제품/이력이 반영되었는가? |
| **Prediction** | 예측 정확도 | 에러 예측이 맞았는가? |
| **Traceability** | 근거 제공률 | 모든 답변에 근거가 있는가? |
| **User Experience** | 시각화 유용성 | 그래프가 이해에 도움이 되는가? |

## 12.2 핵심 지표

| 지표 | 정의 | 목표 |
|------|------|------|
| **Ontology Path Accuracy** | 올바른 관계 경로 비율 | > 85% |
| **Context Integration Rate** | 맥락이 반영된 답변 비율 | > 80% |
| **Prediction Precision** | 예측 에러가 실제 발생한 비율 | > 70% |
| **Evidence Coverage** | 근거가 제공된 답변 비율 | 100% |
| **Graph Usefulness** | 사용자 평가 (1-5) | > 4.0 |

## 12.3 테스트 시나리오

### 시나리오 1: 온톨로지 추론 테스트
```
질문: "Fz가 350N인데 이게 뭐야?"
기대:
- Fz → CRITICAL 상태 인식
- PAT_OVERLOAD 패턴 연결
- CAUSE_GRIP_POSITION 원인 추론
- C189 예측
```

### 시나리오 2: 맥락 인식 테스트
```
질문: "어제 14시쯤 이상했는데 왜 그랬지?"
기대:
- 시간대 인식 (14:00 → SHIFT_B)
- 해당 시간 이벤트 조회
- 제품/작업 맥락 반영
```

### 시나리오 3: 예측 테스트
```
상황: 3일 연속 14시대 PART-C 과부하
기대:
- 패턴 인식
- 내일 C189 발생 예측
- 신뢰도 제시
```

---

# 부록

## A. 용어 정의

| 용어 | 정의 |
|------|------|
| **온톨로지** | 도메인의 엔티티와 관계를 형식적으로 정의한 것 |
| **Manufacturing AX** | 제조 분야의 AI 전환 (AI Transformation) |
| **팔란티어 스타일** | 관계 기반 데이터 통합 + 시각적 그래프 탐색 |
| **온톨로지성 질문** | 관계/맥락 추론이 필요한 질문 |
| **관계 그래프** | 엔티티 간 연결을 시각화한 그래프 |

## B. 관련 문서

| 문서 | 설명 |
|------|------|
| `Axia80_센서_분석_보고서.md` | ATI Axia80 센서 상세 분석 |
| `UR5e_로봇_분석_보고서.md` | UR5e 협동로봇 상세 분석 |
| `온톨로지_스키마_설계.md` | 온톨로지 스키마 상세 설계 |
| `Unified_ROADMAP.md` | 개발 로드맵 |

---

**문서 버전**: 2.0
**작성일**: 2026-01-22
**핵심 변경**: 온톨로지 기반 제조 AX 시스템으로 재정의, 팔란티어 스타일 반영
