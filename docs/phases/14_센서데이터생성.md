# Phase 14: 센서 데이터 생성

> **상태**: ✅ 완료
> **도메인**: 데이터 레이어 (Data)
> **목표**: Axia80 Force/Torque 센서 시뮬레이션 데이터 생성
> **이전 명칭**: Main-S1

---

## 1. 개요

UR5e 로봇에 장착 가능한 Axia80 Force/Torque 센서의 시뮬레이션 데이터를 생성하여
Multi-Modal RAG 시스템에서 센서 데이터를 활용할 수 있도록 준비하는 단계.

---

## 2. 태스크

| # | 태스크 | 상태 |
|---|--------|------|
| 1 | Axia80 센서 스펙 분석 | ✅ |
| 2 | 데이터 생성기 구현 | ✅ |
| 3 | 정상 데이터 패턴 생성 | ✅ |
| 4 | 이상 패턴 삽입 | ✅ |
| 5 | Parquet 저장 | ✅ |

---

## 3. Axia80 센서 스펙

### 3.1 센서 특성

| 항목 | 값 |
|------|-----|
| 모델 | ATI Axia80 |
| 측정 축 | 6축 (Fx, Fy, Fz, Tx, Ty, Tz) |
| 힘 범위 | ±250N (x, y), ±800N (z) |
| 토크 범위 | ±8Nm |
| 샘플링 레이트 | 1000Hz |
| 해상도 | 16bit |

### 3.2 데이터 컬럼

```
┌─────────────────────────────────────────────────────┐
│                  Axia80 데이터 스키마                │
├─────────────────────────────────────────────────────┤
│ timestamp    : datetime (ISO 8601)                  │
│ Fx           : float (N)                            │
│ Fy           : float (N)                            │
│ Fz           : float (N)                            │
│ Tx           : float (Nm)                           │
│ Ty           : float (Nm)                           │
│ Tz           : float (Nm)                           │
│ temperature  : float (°C)                           │
│ status       : str (normal/warning/error)           │
└─────────────────────────────────────────────────────┘
```

---

## 4. 이상 패턴 유형

### 4.1 패턴 정의

| 패턴 | 설명 | 특성 |
|------|------|------|
| **collision** | 충돌 감지 | 급격한 힘 증가 (>150N) |
| **vibration** | 진동 감지 | 고주파 변동 (10Hz+) |
| **overload** | 과부하 | 지속적 고하중 (>200N, >5초) |
| **drift** | 센서 드리프트 | 점진적 기준점 이동 |

### 4.2 패턴 시각화

```
충돌 (collision)           진동 (vibration)
    ▲                          ▲
 150│    ╱╲                    │ ∿∿∿∿∿∿∿∿
 100│   ╱  ╲                   │∿        ∿
  50│  ╱    ╲                  │          ∿∿
   0│──────────▶               │───────────▶
      시간                        시간

과부하 (overload)           드리프트 (drift)
    ▲                          ▲
 200│ ┌──────┐                 │      ╱
 150│ │      │                 │    ╱
 100│ │      │                 │  ╱
  50│─┘      └─               │╱
   0│──────────▶               │───────────▶
      시간                        시간
```

---

## 5. 구현

### 5.1 데이터 생성기

```python
# scripts/generate_sensor_data.py

import numpy as np
import pandas as pd
from datetime import datetime, timedelta
from dataclasses import dataclass
from typing import List

@dataclass
class AnomalyEvent:
    start_time: datetime
    duration_seconds: float
    pattern_type: str
    severity: str
    affected_axes: List[str]

class Axia80Simulator:
    def __init__(self, sample_rate: int = 1000):
        self.sample_rate = sample_rate
        self.noise_level = 0.5  # 기본 노이즈

    def generate_normal_data(
        self, duration_seconds: int
    ) -> pd.DataFrame:
        """정상 데이터 생성"""
        n_samples = duration_seconds * self.sample_rate

        timestamps = pd.date_range(
            start=datetime.now(),
            periods=n_samples,
            freq=f"{1000//self.sample_rate}ms"
        )

        # 기본 정상 값 + 노이즈
        data = {
            "timestamp": timestamps,
            "Fx": np.random.normal(0, self.noise_level, n_samples),
            "Fy": np.random.normal(0, self.noise_level, n_samples),
            "Fz": np.random.normal(-5, self.noise_level, n_samples),  # 중력 보정
            "Tx": np.random.normal(0, 0.01, n_samples),
            "Ty": np.random.normal(0, 0.01, n_samples),
            "Tz": np.random.normal(0, 0.01, n_samples),
            "temperature": np.random.normal(25, 0.5, n_samples),
            "status": ["normal"] * n_samples
        }

        return pd.DataFrame(data)

    def inject_collision(
        self, df: pd.DataFrame, event: AnomalyEvent
    ) -> pd.DataFrame:
        """충돌 패턴 삽입"""
        start_idx = self._time_to_index(event.start_time, df)
        duration_samples = int(event.duration_seconds * self.sample_rate)

        # 충돌 파형: 급격한 상승 후 감쇠
        collision_force = 150 * np.exp(-np.linspace(0, 5, duration_samples))

        for axis in event.affected_axes:
            df.loc[start_idx:start_idx+duration_samples-1, axis] += collision_force

        df.loc[start_idx:start_idx+duration_samples-1, "status"] = "warning"

        return df

    def inject_vibration(
        self, df: pd.DataFrame, event: AnomalyEvent
    ) -> pd.DataFrame:
        """진동 패턴 삽입"""
        start_idx = self._time_to_index(event.start_time, df)
        duration_samples = int(event.duration_seconds * self.sample_rate)

        # 고주파 진동
        t = np.linspace(0, event.duration_seconds, duration_samples)
        vibration = 30 * np.sin(2 * np.pi * 15 * t)  # 15Hz 진동

        for axis in event.affected_axes:
            df.loc[start_idx:start_idx+duration_samples-1, axis] += vibration

        return df
```

### 5.2 생성 스크립트

```python
# 1주일 데이터 생성
simulator = Axia80Simulator(sample_rate=1)  # 1Hz로 다운샘플

# 정상 데이터 생성
df = simulator.generate_normal_data(duration_seconds=604800)  # 1주일

# 이상 이벤트 삽입
anomaly_events = [
    AnomalyEvent(
        start_time=datetime(2026, 1, 15, 10, 30),
        duration_seconds=0.5,
        pattern_type="collision",
        severity="warning",
        affected_axes=["Fz", "Fx"]
    ),
    AnomalyEvent(
        start_time=datetime(2026, 1, 16, 14, 15),
        duration_seconds=3.0,
        pattern_type="vibration",
        severity="warning",
        affected_axes=["Fx", "Fy"]
    ),
    # ... 총 7개 이상 이벤트
]

for event in anomaly_events:
    df = simulator.inject_anomaly(df, event)

# Parquet 저장
df.to_parquet("data/sensor/raw/axia80_week_01.parquet", index=False)
```

---

## 6. 산출물

### 6.1 파일 목록

| 파일 | 내용 | 크기 |
|------|------|------|
| `data/sensor/raw/axia80_week_01.parquet` | 1주일 센서 데이터 | 34.15MB |
| `data/sensor/metadata/sensor_config.yaml` | 센서 설정 | 1.2KB |
| `data/sensor/processed/anomaly_events.json` | 삽입된 이상 이벤트 | 2.1KB |
| `scripts/generate_sensor_data.py` | 생성 스크립트 | ~300 lines |

### 6.2 데이터 통계

| 항목 | 값 |
|------|-----|
| 총 레코드 수 | 604,800 |
| 시간 범위 | 7일 (1주일) |
| 샘플링 레이트 | 1Hz (다운샘플) |
| 이상 이벤트 수 | 7개 |
| 파일 크기 | 34.15MB |

### 6.3 이상 이벤트 목록

| # | 시간 | 유형 | 심각도 | 영향 축 |
|---|------|------|--------|---------|
| 1 | 01/15 10:30 | collision | warning | Fz, Fx |
| 2 | 01/16 14:15 | vibration | warning | Fx, Fy |
| 3 | 01/17 09:00 | overload | error | Fz |
| 4 | 01/18 16:45 | drift | warning | Tx |
| 5 | 01/19 11:20 | collision | warning | Fy, Fz |
| 6 | 01/20 08:30 | vibration | warning | Fx |
| 7 | 01/21 15:00 | overload | error | Fz, Tx |

---

## 7. sensor_config.yaml

```yaml
# data/sensor/metadata/sensor_config.yaml

sensor:
  model: "ATI Axia80"
  serial: "SIM-001"
  firmware: "3.4.2"

measurement:
  axes:
    - name: "Fx"
      unit: "N"
      range: [-250, 250]
    - name: "Fy"
      unit: "N"
      range: [-250, 250]
    - name: "Fz"
      unit: "N"
      range: [-800, 800]
    - name: "Tx"
      unit: "Nm"
      range: [-8, 8]
    - name: "Ty"
      unit: "Nm"
      range: [-8, 8]
    - name: "Tz"
      unit: "Nm"
      range: [-8, 8]

sampling:
  rate: 1  # Hz (다운샘플된 값)
  original_rate: 1000  # Hz (원본)

calibration:
  date: "2026-01-01"
  temperature: 25.0
  zero_offset:
    Fx: 0.0
    Fy: 0.0
    Fz: -5.0  # 중력 보정
    Tx: 0.0
    Ty: 0.0
    Tz: 0.0
```

---

## 8. 검증 체크리스트

- [x] Parquet 파일 생성 (604,800 레코드)
- [x] 6축 데이터 포함 (Fx, Fy, Fz, Tx, Ty, Tz)
- [x] 이상 이벤트 7개 삽입
- [x] sensor_config.yaml 작성
- [x] anomaly_events.json 기록

---

## 9. 다음 단계

→ [Phase 15: 패턴 감지](15_패턴감지.md)

---

**Phase**: 14 / 19
**마일스톤**: 센서 통합 (Phase 14-19) 시작
**작성일**: 2026-01-22
