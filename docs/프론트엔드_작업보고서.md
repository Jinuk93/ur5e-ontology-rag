# 프론트엔드 작업보고서 (P0)

- 작성일: 2026-01-23
- 상태: 진행 중(대화 장애 대비 스냅샷)
- 목적: 대화/에이전트 상태를 clear 하더라도, 레포 기준으로 **무슨 작업을 했는지**와 **다음 할 일**이 남도록 기록

---

## 1) 왜 이 문서를 만들었나

최근 Claude가 아래 오류로 “대화 상태”에 갇히는 문제가 발생했습니다.

- `API Error: 400 ... thinking or redacted_thinking blocks ... cannot be modified`

이 오류는 대화 UI/에이전트가 직전 응답(특히 내부 thinking 블록 포함)을 “수정”하려고 시도할 때 발생할 수 있습니다.
따라서 **대화 clear가 유일한 복구법**인 상황을 대비해, 코드베이스에 현재 진행상황을 고정합니다.

---

## 2) 현재 프론트 코드 상태(레포 기준)

### 2.1 프로젝트 생성

- Next.js(App Router) 프로젝트 생성: `frontend/`
- 설치된 핵심 패키지:
  - UI: shadcn/ui(Radix 기반)
  - Graph: `@xyflow/react` (React Flow)
  - Chart: `recharts`
  - 상태: `zustand`
  - 데이터: `@tanstack/react-query`(현재는 설치만, 적용은 미완)

> 주의: 현재 `frontend/` 폴더는 Git에 아직 add 되지 않은 “untracked” 상태입니다.

### 2.2 타입/어댑터(백엔드 snake_case ↔ 프론트 camelCase)

- 타입: `frontend/src/types/api.ts`
- API 클라이언트 + 변환 어댑터: `frontend/src/lib/api.ts`
  - `normalizeChatResponse(raw)`:
    - `trace_id → traceId`, `query_type → queryType`, `abstain_reason → abstainReason`
    - `evidence.ontology_paths → evidence.ontologyPathObjects`
    - `evidence.document_refs → evidence.documentRefs`
    - `evidence.similar_events → evidence.similarEvents`
    - `graph.nodes/edges` 매핑
  - `buildChatRequest(req)`:
    - `message` 우선 전송, 없으면 `query`
  - 기본 base URL: `NEXT_PUBLIC_API_URL` 없으면 `http://127.0.0.1:8002`

### 2.3 상태 관리

- UI 상태: `frontend/src/stores/uiStore.ts`
  - 뷰 전환(`live|graph|history`), 선택 엔티티, 그래프 중심 노드, 모바일 채팅 열림 상태
- 채팅 상태: `frontend/src/stores/chatStore.ts`
  - 메세지 배열 + 로딩/에러 포함

### 2.4 UI 컴포넌트(현재 구현된 범위)

- 레이아웃
  - `frontend/src/components/layout/Header.tsx`
  - `frontend/src/components/layout/SplitView.tsx`

- Live View(모니터링 느낌의 데모)
  - `frontend/src/components/live/LiveView.tsx`
  - `frontend/src/components/live/ObjectCard.tsx`
  - `frontend/src/components/live/RiskAlertBar.tsx`
  - `frontend/src/components/live/RealtimeChart.tsx`
  - `frontend/src/components/live/EventList.tsx`

- Graph View(React Flow 기반 데모)
  - `frontend/src/components/graph/GraphView.tsx`
  - `frontend/src/components/graph/SubGraph.tsx`
  - `frontend/src/components/graph/OntologyNode.tsx`
  - `frontend/src/components/graph/PathBreadcrumb.tsx`

- History View(차트 컴포넌트 일부)
  - `frontend/src/components/history/TrendChart.tsx`

- shadcn/ui 컴포넌트
  - `frontend/src/components/ui/*`

### 2.5 아직 연결되지 않은 부분(중요)

- `frontend/src/app/page.tsx`가 아직 Next 기본 템플릿 상태입니다.
  - 즉, Header/SplitView/LiveView/GraphView/ChatPanel 등을 실제 페이지에 렌더링 연결하는 작업이 남아있습니다.
- ChatPanel(UI) 및 실제 `/api/chat` 연동 UI는 아직 미완입니다.
- History View의 테이블/필터/패턴 리스트 등은 미완입니다.

---

## 3) 바로 실행(로컬 확인)

PowerShell:

1) 프론트 개발 서버
- `cd frontend`
- `npm run dev`

2) 백엔드(별도 터미널)
- `python scripts/run_api.py --host 127.0.0.1 --port 8002`

환경변수로 API 주소를 바꾸려면:
- `setx NEXT_PUBLIC_API_URL "http://127.0.0.1:8002"`

---

## 4) 대화 clear 해도 작업을 안 잃는 방법(운영 규칙)

1) 코드가 쌓이면 바로 Git에 기록
- `git add frontend`
- `git commit -m "frontend: scaffold P0 UI"`
- `git push`

2) 문서도 같이 스냅샷
- 이 파일(`docs/프론트엔드_작업보고서.md`)에 진행상황/다음할일을 누적
- API 계약 변경이 생기면 `docs/UI_설계_명세서.md`와 `docs/재현성검증.md` 업데이트

---

## 5) 다음 할 일(우선순위)

- (P0) `frontend/src/app/page.tsx`를 “실제 대시보드”로 연결
  - Header + SplitView
  - main: Live/Graph/History 탭
  - side: ChatPanel

- (P0) ChatPanel 구현
  - 입력 → `sendChatMessage()` 호출
  - 응답(`ChatResponse`)에서 `evidence/graph`를 화면에 표시
  - `traceId`로 Evidence 상세 보기(옵션)

- (P1) History View 확장
  - 패턴 테이블, 필터, 추세/마커

- (P1) React Query 적용
  - `/health`, `/api/ontology/summary` 등 fetch 캐싱

---

## 6) 변경 이력(계속 누적)

- 2026-01-23: `frontend/` Next.js + Tailwind + shadcn/ui 초기 세팅
- 2026-01-23: 타입(`src/types/api.ts`) + API 어댑터(`src/lib/api.ts`) 추가
- 2026-01-23: Live/Graph/TrendChart 컴포넌트 뼈대 추가
