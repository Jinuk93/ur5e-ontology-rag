# UR5e 온톨로지 스키마 설계

> **문서 버전**: 2.0
> **목적**: 제조 AX(AI Transformation)를 위한 온톨로지 기반 RAG 시스템 설계
> **참고 문서**: reports/domain/sensor/Axia80_센서_분석_보고서.md, reports/domain/robot/UR5e_로봇_분석_보고서.md

---

## 목차

1. [온톨로지란 무엇인가](#1-온톨로지란-무엇인가)
2. [왜 온톨로지인가](#2-왜-온톨로지인가)
3. [시스템 아키텍처](#3-시스템-아키텍처)
4. [온톨로지 도메인 설계](#4-온톨로지-도메인-설계)
5. [엔티티 정의](#5-엔티티-정의)
6. [관계 정의](#6-관계-정의)
7. [추론 규칙](#7-추론-규칙)
8. [질문 유형별 처리](#8-질문-유형별-처리)
9. [데이터 흐름](#9-데이터-흐름)
10. [시각화 컨셉 (팔란티어 스타일)](#10-시각화-컨셉-팔란티어-스타일)
11. [구현 명세](#11-구현-명세)

---

# 1. 온톨로지란 무엇인가

## 1.1 일반적 정의

**온톨로지(Ontology)** = 특정 도메인에 존재하는 개체(Entity)들과 그들 간의 관계(Relationship)를 형식적으로 정의한 것

```
철학에서:    "존재하는 것은 무엇인가?" (What exists?)
컴퓨터에서:  "데이터가 무엇을 의미하는가?" (What does data mean?)
제조 AX에서: "이 수치들이 생산에 어떤 영향을 주는가?" (What do these values mean for production?)
```

## 1.2 우리 프로젝트에서의 온톨로지 정의

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│   온톨로지 = AI가 제조 데이터의 복잡한 관계를 이해하기 위한 "관계 데이터" │
│                                                                          │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                     제조 현장의 현실                             │   │
│   │                                                                  │   │
│   │    ┌─────┐    ┌─────┐    ┌─────┐    ┌─────┐                    │   │
│   │    │UR5e │←──→│Axia │←──→│ PLC │←──→│센서D│  ... n개 이기종    │   │
│   │    │로봇 │    │ 80  │    │     │    │     │                    │   │
│   │    └─────┘    └─────┘    └─────┘    └─────┘                    │   │
│   │         ↑         ↑         ↑         ↑                        │   │
│   │         └─────────┴─────────┴─────────┘                        │   │
│   │                   복잡한 상호작용                                │   │
│   │                         │                                       │   │
│   │                         ▼                                       │   │
│   │              AI가 이해하기 어려움                                │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                              │                                           │
│                              ▼                                           │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                    온톨로지의 역할                               │   │
│   │                                                                  │   │
│   │    • 엔티티(Entity) 정의: "Axia80은 F/T 센서이다"               │   │
│   │    • 속성(Property) 정의: "Fz의 정상 범위는 -60N~0N이다"        │   │
│   │    • 관계(Relationship) 정의: "Axia80은 UR5e에 장착되어 있다"   │   │
│   │    • 규칙(Rule) 정의: "Fz > 500N/100ms이면 충돌이다"            │   │
│   │                                                                  │   │
│   │    → AI가 이해할 수 있는 구조화된 지식                          │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                              │                                           │
│                              ▼                                           │
│                    자율 조절 / 의사결정 지원                             │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 1.3 온톨로지의 구성 요소

| 구성 요소 | 설명 | 예시 |
|-----------|------|------|
| **Entity (개체)** | 도메인의 핵심 객체 | UR5e, Axia80, Joint, ErrorCode |
| **Property (속성)** | 개체의 특성 | Fz.range = [-235, 235], UR5e.payload = 5kg |
| **Relationship (관계)** | 개체 간 의미적 연결 | Axia80 --MOUNTED_ON--> UR5e |
| **Rule (규칙)** | 추론을 위한 논리 | IF Fz_spike > 500N THEN pattern = COLLISION |
| **Instance (인스턴스)** | 실제 데이터 | Fz = -180N at 2024-01-17T14:30:00 |

---

# 2. 왜 온톨로지인가

## 2.1 룰베이스 vs 온톨로지

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        현재: 룰베이스 (Rule-based)                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   IF Fz > 500N THEN alert("과부하")                                     │
│   IF error_code == "C153" THEN show("장애물 제거하세요")                │
│   IF temperature > 80 THEN warning("과열")                              │
│                                                                          │
│   특징:                                                                  │
│   ✓ 단순하고 빠름                                                       │
│   ✓ 예측 가능한 동작                                                    │
│   ✗ 사전 정의된 조건만 처리                                             │
│   ✗ 맥락/관계 이해 불가                                                 │
│   ✗ 새로운 상황 대응 어려움                                             │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────┐
│                        미래: 온톨로지 기반 (Ontology-based)              │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   "Fz = -350N인데, 이게 뭐야?"                                           │
│                                                                          │
│   온톨로지 추론:                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │ 1. Fz 축 컨텍스트 로딩                                          │   │
│   │    → Axia80.Fz.normal_range = [-60N, 0N]                        │   │
│   │    → -350N은 정상 범위의 약 6배                                  │   │
│   │                                                                  │   │
│   │ 2. 현재 상황 분석                                                │   │
│   │    → 시간: 14:30 (B조 근무)                                      │   │
│   │    → 제품: PART-C (4.2kg)                                        │   │
│   │    → 작업: pick 단계                                             │   │
│   │                                                                  │   │
│   │ 3. 이력 패턴 매칭                                                │   │
│   │    → 유사 사례: EVT-003, EVT-004, EVT-005                       │   │
│   │    → 3일 연속 14시대 PART-C에서 과부하 발생                     │   │
│   │    → 4일차에 C189 에러 발생 (EVT-006)                           │   │
│   │                                                                  │   │
│   │ 4. 관계 기반 추론                                                │   │
│   │    → 원인 추정: PART-C 그립 위치 불량 (80%)                     │   │
│   │    → 예상 결과: 내일 C189 발생 가능성 높음                      │   │
│   │    → 영향 범위: Joint 1, 2 과부하                                │   │
│   │                                                                  │   │
│   │ 5. 권장 조치                                                     │   │
│   │    → 즉시: 그립 위치 확인                                        │   │
│   │    → 단기: PART-C 작업 SOP 검토                                 │   │
│   │    → 참고: Service Manual p.45                                   │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│   특징:                                                                  │
│   ✓ 맥락 기반 이해                                                      │
│   ✓ 관계 기반 추론                                                      │
│   ✓ 이력/패턴 학습                                                      │
│   ✓ 예측 및 예방 가능                                                   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 2.2 제조 AX에서 온톨로지가 필수인 이유

```
제조 현장의 복잡성:

    ┌─────┐     ┌─────┐     ┌─────┐
    │로봇1│────→│센서A│────→│품질 │
    └─────┘     └─────┘     │검사 │
        ↑                    └──┬──┘
        │     ┌─────┐          │
        └─────│ PLC │←─────────┘
              └─────┘
                ↑
    ┌─────┐     │     ┌─────┐
    │로봇2│─────┴────→│센서B│
    └─────┘           └─────┘

    → 수십 개의 장비가 상호 연결
    → 하나의 이상이 전체에 영향
    → 단순 룰로는 관계 파악 불가

온톨로지의 해결:

    [로봇1] ──USES──→ [센서A] ──FEEDS──→ [품질검사]
       │                                      │
       └──────CONTROLLED_BY──→ [PLC] ←────────┘
                                 ↑
    [로봇2] ──USES──→ [센서B] ───┘

    → 관계가 명시적으로 정의됨
    → "센서A 이상 시 영향받는 것은?" 쿼리 가능
    → AI가 전체 시스템을 이해할 수 있음
```

## 2.3 팔란티어(Palantir)와의 비교

| 항목 | 팔란티어 Foundry | 우리 프로젝트 |
|------|-----------------|--------------|
| **규모** | 엔터프라이즈 | 소규모 데모 |
| **데이터 소스** | 수백~수천 개 | 2개 (UR5e, Axia80) |
| **온톨로지** | 도메인 전체 모델링 | 제조 일부 모델링 |
| **목표** | 실제 운영 | 개념 증명 (PoC) |
| **핵심 가치** | 동일: 관계 기반 데이터 이해 및 추론 |

```
팔란티어 스타일의 핵심:

1. 이기종 데이터 통합 (Heterogeneous Data Integration)
   → 우리: Axia80 센서 + UR5e 로봇 + 문서

2. 온톨로지 기반 관계 정의 (Ontology-based Relationships)
   → 우리: 센서 → 패턴 → 에러 → 원인 → 해결책

3. 시각적 그래프 탐색 (Visual Graph Exploration)
   → 우리: 관계 그래프 UI

4. 맥락 기반 분석 (Context-aware Analysis)
   → 우리: 시간대, 제품, 작업자 컨텍스트 반영
```

---

# 3. 시스템 아키텍처

## 3.1 전체 구조

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        UR5e Ontology RAG System                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌────────────────┐                                                     │
│  │   사용자 질문   │                                                     │
│  │                │                                                     │
│  │ "Fz가 -350N인데 │                                                     │
│  │  이게 뭐야?"   │                                                     │
│  └───────┬────────┘                                                     │
│          │                                                              │
│          ▼                                                              │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │                    Query Classifier                            │     │
│  │                    (질문 유형 분류)                             │     │
│  │                                                                │     │
│  │   온톨로지성 질문 ←─────────────────→ 일반 RAG 질문            │     │
│  │   "Fz가 -350N인데..."               "UR5e 페이로드가 몇 kg?"   │     │
│  └───────┬───────────────────────────────────┬───────────────────┘     │
│          │                                   │                          │
│          ▼                                   ▼                          │
│  ┌───────────────────────┐          ┌───────────────────────┐          │
│  │   Ontology Engine     │          │   Vector Search       │          │
│  │                       │          │                       │          │
│  │ • 엔티티 인식         │          │ • 문서 청크 검색      │          │
│  │ • 관계 탐색           │          │ • 유사도 기반 매칭    │          │
│  │ • 규칙 기반 추론      │          │                       │          │
│  │ • 컨텍스트 로딩       │          │                       │          │
│  └───────┬───────────────┘          └───────────┬───────────┘          │
│          │                                       │                      │
│          └───────────────┬───────────────────────┘                      │
│                          │                                              │
│                          ▼                                              │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │                      LLM (추론 엔진)                           │     │
│  │                                                                │     │
│  │   온톨로지 데이터 + 문서 컨텍스트 → 통합 추론 → 응답 생성     │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                          │                                              │
│                          ▼                                              │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │                      응답 (Response)                           │     │
│  │                                                                │     │
│  │   • 구조화된 분석 결과                                        │     │
│  │   • 자연어 설명                                               │     │
│  │   • 관계 그래프 시각화                                        │     │
│  │   • 참고 문서 링크                                            │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 3.2 온톨로지 vs LLM 역할 분담

```
┌─────────────────────────────────────────────────────────────────────────┐
│                                                                          │
│   [온톨로지]                              [LLM]                         │
│   ═══════════                            ═══════                        │
│   관계 데이터 (What)                     추론 엔진 (How)                │
│                                                                          │
│   ┌─────────────────────────┐           ┌─────────────────────────┐    │
│   │ • 엔티티 정의           │           │ • 자연어 이해           │    │
│   │   "Axia80은 센서다"     │           │   "Fz가 뭐야?" 해석     │    │
│   │                         │           │                         │    │
│   │ • 관계 정의             │           │ • 온톨로지 기반 추론    │    │
│   │   "Axia80 → UR5e 장착"  │           │   여러 관계 조합 분석   │    │
│   │                         │           │                         │    │
│   │ • 속성/범위 정의        │           │ • 자연어 응답 생성      │    │
│   │   "Fz 정상: -60~0N"     │           │   사람이 이해하기 쉽게  │    │
│   │                         │           │                         │    │
│   │ • 규칙 정의             │           │ • 맥락 통합             │    │
│   │   "Fz>500N/100ms=충돌"  │           │   여러 정보 종합 판단   │    │
│   └─────────────────────────┘           └─────────────────────────┘    │
│              │                                     │                    │
│              │     "무엇이 무엇과                  │                    │
│              │      어떻게 연결되어 있는가"        │                    │
│              │                                     │                    │
│              └─────────────┬───────────────────────┘                    │
│                            │                                            │
│                            ▼                                            │
│              ┌─────────────────────────────────┐                        │
│              │  "그래서 이 상황은 무엇이고,    │                        │
│              │   어떻게 해야 하는가"           │                        │
│              └─────────────────────────────────┘                        │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 4. 온톨로지 도메인 설계

## 4.1 4-Domain 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        UR5e Ontology Domains                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐   │
│  │                   │  │                   │  │                   │   │
│  │    Equipment      │  │   Measurement     │  │    Knowledge      │   │
│  │    Domain         │◀─▶    Domain         │◀─▶    Domain         │   │
│  │                   │  │                   │  │                   │   │
│  │   물리적 장비     │  │   센서/측정       │  │   문제해결 지식   │   │
│  │                   │  │                   │  │                   │   │
│  └───────────────────┘  └───────────────────┘  └───────────────────┘   │
│           │                     │                     │                 │
│           ▼                     ▼                     ▼                 │
│  ┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐   │
│  │ • UR5e Robot      │  │ • Axia80 Sensor   │  │ • Error Codes     │   │
│  │ • Joints (0-5)    │  │ • Axes (Fx~Tz)    │  │ • Causes          │   │
│  │ • Control Box     │  │ • States          │  │ • Resolutions     │   │
│  │ • Tool Flange     │  │ • Patterns        │  │ • Documents       │   │
│  │ • Gripper         │  │ • Thresholds      │  │ • Procedures      │   │
│  └───────────────────┘  └───────────────────┘  └───────────────────┘   │
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    Context Domain (운영 컨텍스트)                  │  │
│  │                                                                   │  │
│  │   • Shifts (A/B/C조)  • Products (PART-A/B/C)  • Operators       │  │
│  │   • Work Cycles       • Time Patterns         • Historical Data  │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## 4.2 도메인 간 관계

| 도메인 | 역할 | 다른 도메인과의 관계 |
|--------|------|---------------------|
| **Equipment** | 물리적 장비 구조 | Measurement(센서 장착), Knowledge(에러 발생 위치) |
| **Measurement** | 센서 측정/상태 | Equipment(측정 대상), Knowledge(패턴→에러 연결) |
| **Knowledge** | 문제해결 지식 | Equipment(영향 컴포넌트), Measurement(트리거 조건) |
| **Context** | 운영 컨텍스트 | 모든 도메인에 맥락 제공 |

---

# 5. 엔티티 정의

## 5.1 Equipment Domain

### Robot (로봇)

```yaml
Robot:
  id: "UR5e"
  type: "Collaborative Robot"
  manufacturer: "Universal Robots"
  properties:
    payload_kg: 5.0
    reach_mm: 850
    dof: 6
    repeatability_mm: 0.03
    weight_kg: 20.6
  components:
    - ControlBox
    - RobotArm
    - TeachPendant
```

### Joint (조인트)

```yaml
Joint:
  instances:
    - id: "Joint_0"
      name: "Base"
      index: 0
      max_torque_nm: 150
      max_speed_deg_s: 180

    - id: "Joint_1"
      name: "Shoulder"
      index: 1
      max_torque_nm: 150
      load_characteristic: "highest_load"

    - id: "Joint_2"
      name: "Elbow"
      index: 2
      max_torque_nm: 150
      load_characteristic: "second_highest_load"

    - id: "Joint_3"
      name: "Wrist1"
      index: 3
      max_torque_nm: 28

    - id: "Joint_4"
      name: "Wrist2"
      index: 4
      max_torque_nm: 28

    - id: "Joint_5"
      name: "Wrist3"
      index: 5
      max_torque_nm: 28
      connected_to: "ToolFlange"
```

## 5.2 Measurement Domain

### Sensor (센서)

```yaml
Sensor:
  id: "Axia80"
  type: "Force/Torque Sensor"
  model: "ATI Axia80 M8"
  manufacturer: "ATI Industrial Automation"
  properties:
    axes: 6
    sampling_rate_hz: 7200  # 최대 (운영: 125Hz)
    mounted_on: "ToolFlange"
```

### MeasurementAxis (측정축)

```yaml
MeasurementAxis:
  instances:
    - id: "Fz"
      type: "force"
      direction: "Z (vertical)"
      unit: "N"
      range: [-235, 235]
      importance: "primary"
      states:
        # 상태 구간은 운영 분류용이며, 문서 예시의 normal_range(예: -60~0N)와는 별개 개념
        # - 예시 normal_range: 간략화된 "정상 기준선" 설명용
        # - states: 실제 운영 상태 분류 (IDLE~CRITICAL)
        IDLE: [-20, -10]
        LIGHT_LOAD: [-40, -20]
        NORMAL_LOAD: [-70, -40]
        HEAVY_LOAD: [-100, -70]
        WARNING: [-200, -100]
        CRITICAL: [-235, -200]

    - id: "Fx"
      type: "force"
      direction: "X (horizontal)"
      unit: "N"
      range: [-75, 75]

    - id: "Fy"
      type: "force"
      direction: "Y (horizontal)"
      unit: "N"
      range: [-75, 75]

    - id: "Tx"
      type: "torque"
      direction: "X-axis rotation"
      unit: "Nm"
      range: [-4, 4]

    - id: "Ty"
      type: "torque"
      direction: "Y-axis rotation"
      unit: "Nm"
      range: [-4, 4]

    - id: "Tz"
      type: "torque"
      direction: "Z-axis rotation"
      unit: "Nm"
      range: [-4, 4]
```

### SensorPattern (센서 패턴)

```yaml
SensorPattern:
  instances:
    - id: "PAT_COLLISION"
      type: "collision"
      severity: "critical"
      detection:
        condition: "delta > 500N within 100ms"
      indicates:
        - CAUSE_PHYSICAL_CONTACT (95%)
      triggers:
        - C153 (95%)
        - C119 (80%)

    - id: "PAT_OVERLOAD"
      type: "overload"
      severity: "high"
      detection:
        condition: "abs(value) > 150N for > 5s"
      indicates:
        - CAUSE_PAYLOAD_EXCEEDED (90%)
      triggers:
        - C189 (90%)

    - id: "PAT_VIBRATION"
      type: "vibration"
      severity: "medium"
      detection:
        condition: "std_dev > 2x baseline for > 10s"
      indicates:
        - CAUSE_JOINT_WEAR (70%)
      triggers:
        - C192 (75%)

    - id: "PAT_DRIFT"
      type: "drift"
      severity: "low"
      detection:
        condition: "baseline shift > 10% over 30min"
      indicates:
        - CAUSE_CALIBRATION_NEEDED (80%)
```

## 5.3 Knowledge Domain

### ErrorCode (에러 코드)

```yaml
ErrorCode:
  instances:
    - id: "C153"
      name: "Safety System Violation"
      category: "safety"
      severity: "critical"
      caused_by:
        - CAUSE_PHYSICAL_CONTACT
        - CAUSE_UNEXPECTED_OBSTACLE
      resolved_by:
        - RES_CLEAR_OBSTRUCTION
        - RES_CHECK_PROGRAM_PATH
      documented_in:
        - user_manual: p.145
        - service_manual: p.67

    - id: "C189"
      name: "Payload Exceeded"
      category: "overload"
      severity: "high"
      threshold:
        max_payload_kg: 5.0
      caused_by:
        - CAUSE_PAYLOAD_EXCEEDED
        - CAUSE_GRIP_POSITION
      resolved_by:
        - RES_REDUCE_PAYLOAD
        - RES_ADJUST_GRIP_POSITION

    - id: "C119"
      name: "Protective Stop"
      category: "safety"
      severity: "high"
      caused_by:
        - CAUSE_PHYSICAL_CONTACT
      resolved_by:
        - RES_CHECK_SURROUNDINGS
```

### Cause (원인)

```yaml
Cause:
  instances:
    - id: "CAUSE_PHYSICAL_CONTACT"
      name: "물리적 접촉"
      category: "physical"
      indicators:
        - pattern: PAT_COLLISION

    - id: "CAUSE_PAYLOAD_EXCEEDED"
      name: "페이로드 초과"
      category: "mechanical"
      indicators:
        - pattern: PAT_OVERLOAD

    - id: "CAUSE_GRIP_POSITION"
      name: "그립 위치 불량"
      category: "operational"
      indicators:
        - pattern: PAT_OVERLOAD
        - Tx/Ty deviation

    - id: "CAUSE_CALIBRATION_NEEDED"
      name: "캘리브레이션 필요"
      category: "sensor"
      indicators:
        - pattern: PAT_DRIFT
```

### Resolution (해결책)

```yaml
Resolution:
  instances:
    - id: "RES_CLEAR_OBSTRUCTION"
      name: "장애물 제거"
      steps:
        - "로봇 정지 상태 유지"
        - "작업 영역 장애물 확인"
        - "장애물 제거"
        - "프로그램 경로 검토"
        - "저속 재시작"
      resolves: [CAUSE_PHYSICAL_CONTACT]
      prevents: [C153, C119]

    - id: "RES_REDUCE_PAYLOAD"
      name: "페이로드 감소"
      steps:
        - "물체 무게 확인"
        - "5kg 이하로 조정"
        - "Payload 설정 확인"
      resolves: [CAUSE_PAYLOAD_EXCEEDED]
      prevents: [C189]

    - id: "RES_ADJUST_GRIP_POSITION"
      name: "그립 위치 조정"
      steps:
        - "그립 위치 확인"
        - "무게 중심에 맞게 조정"
        - "Tx, Ty 모니터링"
      resolves: [CAUSE_GRIP_POSITION]
      prevents: [C189]
```

## 5.4 Context Domain

```yaml
Context:
  Shift:
    - id: "SHIFT_A"
      hours: "06:00-14:00"
    - id: "SHIFT_B"
      hours: "14:00-22:00"
    - id: "SHIFT_C"
      hours: "22:00-06:00"

  Product:
    - id: "PART-A"
      payload_kg: 1.0
      class: "light"
    - id: "PART-B"
      payload_kg: 2.5
      class: "normal"
    - id: "PART-C"
      payload_kg: 4.2
      class: "heavy"
      risk_factors: ["페이로드 상한 근접"]

  WorkCycle:
    phases: [idle, approach, pick, retract, place]

  # 패턴 발생 인스턴스 (traceability)
  Event:
    - id: "EVT-001"
      timestamp: "2024-01-17T14:30:00"
      pattern_ref: "PAT_COLLISION"  # INSTANCE_OF 관계
      features:
        delta_Fz_N: 520.3
        rise_time_ms: 95
      thresholds:
        delta_threshold_N: 500
        rise_time_max_ms: 100
      judgment: "delta_Fz_N(520.3) > threshold(500) within 95ms"
```

**Event 엔티티 설계 근거**:
- Pattern = "정의(클래스)" / Event = "발생(인스턴스)" 구분
- features: 추론에 사용된 실제 측정값 (trace용)
- judgment: 왜 이 패턴으로 판단했는지 설명

---

# 6. 관계 정의

## 6.1 관계 타입

| 관계 | 설명 | 예시 |
|------|------|------|
| **HAS_COMPONENT** | 장비 계층 | UR5e → Joint_0 |
| **MOUNTED_ON** | 센서 장착 | Axia80 → ToolFlange |
| **MEASURES** | 측정 대상 | Axia80 → Fz |
| **HAS_STATE** | 상태 보유 | Fz → NORMAL_LOAD |
| **INDICATES** | 패턴→원인 | PAT_COLLISION → CAUSE_PHYSICAL_CONTACT |
| **TRIGGERS** | 패턴→에러 | PAT_COLLISION → C153 |
| **CAUSED_BY** | 에러→원인 | C153 → CAUSE_PHYSICAL_CONTACT |
| **RESOLVED_BY** | 원인→해결 | CAUSE_PHYSICAL_CONTACT → RES_CLEAR_OBSTRUCTION |
| **PREVENTS** | 해결→에러 | RES_CLEAR_OBSTRUCTION → C153 |
| **DOCUMENTED_IN** | 문서 참조 | C153 → UserManual#p145 |
| **AFFECTS** | 영향 컴포넌트 | C153 → Joint |
| **INSTANCE_OF** | 발생→정의 | EVT-001 → PAT_COLLISION |
| **OCCURS_DURING** | 컨텍스트 | EVT-001 → SHIFT_B |
| **INVOLVES** | 관련 제품 | EVT-001 → PART-C |

## 6.2 관계 그래프 (간략화)

```
[UR5e] ──HAS_COMPONENT──→ [Joint_5] ──HAS_COMPONENT──→ [ToolFlange]
                                                            │
                                                       MOUNTED_ON
                                                            │
                                                            ▼
                                                       [Axia80]
                                                            │
                                                        MEASURES
                                                            │
                                    ┌───────────────────────┼───────────────────────┐
                                    ▼                       ▼                       ▼
                                  [Fx]                    [Fz]                    [Tx]
                                                           │
                                                       HAS_STATE
                                    ┌──────────────────────┼──────────────────────┐
                                    ▼                      ▼                      ▼
                               [NORMAL]              [WARNING]              [COLLISION]
                                                          │                      │
                                                      INDICATES              INDICATES
                                                          │                      │
                                                          ▼                      ▼
                                                   [PAT_OVERLOAD]         [PAT_COLLISION]
                                                          │                      │
                                                      TRIGGERS               TRIGGERS
                                                          │                      │
                                                          ▼                      ▼
                                                       [C189]                 [C153]
                                                          │                      │
                                                     RESOLVED_BY            RESOLVED_BY
                                                          │                      │
                                                          ▼                      ▼
                                                 [RES_REDUCE_PAYLOAD]  [RES_CLEAR_OBSTRUCTION]
```

---

# 7. 추론 규칙

## 7.1 상태 추론

```yaml
StateRules:
  - rule: "RULE_FZ_STATE"
    logic: |
      IF Fz in [-20, -10] THEN state = IDLE
      IF Fz in [-70, -40] THEN state = NORMAL_LOAD
      IF Fz in [-200, -100] THEN state = WARNING
      IF Fz < -200 THEN state = CRITICAL
```

## 7.2 패턴 추론

```yaml
PatternRules:
  - rule: "RULE_COLLISION"
    logic: |
      IF abs(delta_Fz) > 500N within 100ms
      THEN pattern = COLLISION

  - rule: "RULE_OVERLOAD"
    logic: |
      IF abs(Fz) > 150N for > 5s
      THEN pattern = OVERLOAD
```

## 7.3 원인 추론 (컨텍스트 기반)

```yaml
CauseRules:
  - rule: "RULE_RECURRING_OVERLOAD"
    logic: |
      IF pattern = OVERLOAD
        AND product = "PART-C"
        AND shift = "B"
        AND similar_events >= 3 in 4 days
      THEN cause = CAUSE_GRIP_POSITION (confidence: 85%)
```

## 7.4 예측 규칙

```yaml
PredictionRules:
  - rule: "RULE_PREDICT_C189"
    logic: |
      IF overload_count >= 3 within 4 days
        AND same_time_window
        AND same_product
        AND trend = increasing
      THEN predict C189 within 24h (probability: 85%)
```

---

# 8. 질문 유형별 처리

## 8.1 질문 분류

| 유형 | 예시 | 처리 방식 |
|------|------|----------|
| **온톨로지성** | "Fz가 -350N인데 이게 뭐야?" | 관계 추론 + 맥락 분석 |
| **하이브리드** | "C153이 자주 발생하는 이유가 뭐야?" | 온톨로지 + 문서 검색 |
| **일반 RAG** | "UR5e 페이로드가 몇 kg이야?" | 문서 검색 |

## 8.2 온톨로지성 질문 처리 (차별화 포인트)

```
입력: "Fz가 -350N인데 이게 뭐야?"

처리 파이프라인:
1. 엔티티 인식 → Fz, -350N
2. 온톨로지 컨텍스트 로딩 → 정상 범위, 상태 정의
3. 상태 추론 → CRITICAL
4. 패턴 매칭 → COLLISION 가능성
5. 관계 탐색 → 원인, 에러, 해결책
6. 문서 연결 → 참고 매뉴얼
7. 응답 생성 → 구조화된 분석 + 자연어 설명
```

## 8.3 차별화 비교

| 항목 | 일반 RAG | 온톨로지 기반 |
|------|----------|--------------|
| **처리 방식** | 문서 검색 → 답변 | 관계 추론 → 맥락 분석 → 답변 |
| **응답 깊이** | 단순 정보 제공 | 원인-결과-해결책 연결 |
| **맥락 이해** | 없음 | 시간, 제품, 이력 반영 |
| **예측** | 불가 | 가능 (패턴 기반) |
| **시각화** | 없음 | 관계 그래프 제공 |

---

# 9. 데이터 흐름

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          Data Flow                                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  [Data Sources]                                                         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │
│  │ Axia80 센서  │  │  UR5e 로봇   │  │  문서 (PDF)  │                  │
│  │ (7일 데이터) │  │  (에러로그)  │  │ (722 chunks) │                  │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘                  │
│         │                 │                 │                           │
│         ▼                 ▼                 ▼                           │
│  [Processing]                                                           │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                  │
│  │ 패턴 감지    │  │ 이벤트 추출  │  │ 벡터 임베딩  │                  │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘                  │
│         │                 │                 │                           │
│         └────────────────┬┴─────────────────┘                           │
│                          │                                              │
│                          ▼                                              │
│  [Ontology Layer]                                                       │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │  Equipment ←──→ Measurement ←──→ Knowledge ←──→ Context       │     │
│  │  ~50 Entities, ~100 Relationships, ~20 Rules                  │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                          │                                              │
│                          ▼                                              │
│  [Query Processing]                                                     │
│  ┌───────────────────────────────────────────────────────────────┐     │
│  │  사용자 질문 → 분류 → 온톨로지/벡터 검색 → LLM → 응답        │     │
│  └───────────────────────────────────────────────────────────────┘     │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 10. 시각화 컨셉 (팔란티어 스타일)

## 10.1 메인 대시보드

```
┌─────────────────────────────────────────────────────────────────────────┐
│  UR5e Ontology Dashboard                              [Settings] [Help] │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌──────────────────────┐  ┌────────────────────────────────────────┐  │
│  │  📊 Real-time Status │  │  💬 Query Interface                     │  │
│  │                      │  │                                         │  │
│  │  Fz: -52N  ✓        │  │  ┌─────────────────────────────────┐   │  │
│  │  Tx: 0.1Nm ✓        │  │  │ "Fz가 -350N인데 이게 뭐야?"      │   │  │
│  │                      │  │  └─────────────────────────────────┘   │  │
│  │  Status: ● NORMAL    │  │                              [Ask] ▶   │  │
│  └──────────────────────┘  └────────────────────────────────────────┘  │
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  🔗 Knowledge Graph Viewer                                        │  │
│  │                                                                    │  │
│  │      [UR5e] ── [Axia80] ── [Fz] ── [COLLISION] ── [C153]         │  │
│  │                              ↑                                    │  │
│  │                          Selected                                 │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │  📈 Sensor Timeline                                                │  │
│  │      ● EVT-001 (Collision)  ● EVT-003~006 (Overload)              │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

---

# 11. 구현 명세

## 11.1 기술 스택

| 레이어 | 기술 | 용도 |
|--------|------|------|
| **Ontology** | JSON/YAML | 엔티티/관계 저장 |
| **Vector DB** | ChromaDB | 문서 임베딩 |
| **Backend** | FastAPI | API 서버 |
| **LLM** | OpenAI GPT-4 | 추론/생성 |
| **Frontend** | React + D3.js | UI/그래프 |

## 11.2 핵심 API

```yaml
Endpoints:
  POST /api/chat:
    input: { query, context }
    output: { answer, trace_id, evidence, graph }

  GET /api/evidence/{trace_id}:
    output: { found, evidence, full_response }

  GET /api/ontology/summary:
    output: { entities, relations, graph }

  GET /api/sensors/readings:
    output: { readings[], total_count }
```

---

# 요약

## 핵심 차별화

| 항목 | 일반 RAG | 온톨로지 기반 |
|------|----------|--------------|
| **데이터 이해** | 텍스트 검색 | 관계 기반 이해 |
| **응답** | 단편적 정보 | 구조화된 분석 + 그래프 |
| **예측** | 불가 | 패턴 기반 예측 |

## 제조 AX 관점

```
현재: 룰베이스 알람
        ↓
미래: 온톨로지 기반 AI
        ↓
목표: 자율 조절 + 의사결정 지원

우리 프로젝트 = 이 미래의 "개념 증명(PoC)"
```

---

# 12. 온톨로지 확장 v2.0 (2026-01-26)

## 12.1 확장 배경

기존 v1.0 온톨로지는 14개 에러 코드만 포함하여, 벤치마크 QA 테스트에서 대부분의 질문에 "근거 불충분(ABSTAIN)"으로 응답하는 문제가 발생했습니다. 이를 해결하기 위해 A+C 하이브리드 접근법을 채택하여 대규모 확장을 수행했습니다.

## 12.2 확장 결과

| 항목 | v1.0 (이전) | v2.0 (확장) | 증가율 |
|------|------------|------------|--------|
| 에러 코드 (ErrorCode) | 14개 | **99개** | +607% |
| 원인 (Cause) | 6개 | **20개** | +233% |
| 해결책 (Resolution) | 5개 | **15개** | +200% |
| 패턴 (Pattern) | 4개 | **8개** | +100% |
| 관계 (Relationship) | 58개 | **155개** | +167% |
| 장비 엔티티 | 9개 | **12개** | +33% |

## 12.3 새로 추가된 에러 코드 카테고리

- communication, system, encoder, calibration, memory
- configuration, power, joint_communication, joint_position
- joint_current, joint_speed, joint_temperature, safety, safety_io
- io, tool, control_box, safety_board, motherboard, teach_pendant
- euromap, hardware, software, sensor, overload, vibration

## 12.4 참고 문서

- [온톨로지_확장_v2.0.md](온톨로지_확장_v2.0.md) - 상세 확장 작업 보고서