# 온톨로지 확장 v2.0 - 작업 보고서

> **작업일**: 2026-01-26
> **버전**: v1.0 → v2.0
> **목적**: 챗봇 응답 품질 향상을 위한 온톨로지 대규모 확장

---

## 1. 개요

### 1.1 배경

기존 온톨로지(v1.0)는 14개의 에러 코드만 포함하여, 벤치마크 QA 테스트에서 대부분의 질문에 "근거 불충분(ABSTAIN)"으로 응답하는 문제가 발생했습니다.

**문제점 분석**:
- 온톨로지에 14개 에러 코드만 정의 (C4, C10, C50-55, C119, C153, C189, C204)
- 벤치마크 QA에서 요구하는 에러 코드 대부분 누락 (C103, C151, C200, C259 등)
- RAG 청크에는 99개 에러 코드 정보가 있으나, 온톨로지 기반 구조화된 응답 불가

### 1.2 해결 방안

**A+C 하이브리드 접근법** 채택:
- **A (온톨로지 확장)**: 99개 에러 코드 + 확장된 원인/해결책/패턴 추가
- **C (RAG 연동)**: 상세 설명은 RAG 검색으로 보완

---

## 2. 확장 결과 요약

| 항목 | v1.0 (이전) | v2.0 (확장) | 증가율 |
|------|------------|------------|--------|
| 에러 코드 (ErrorCode) | 14개 | **99개** | +607% |
| 원인 (Cause) | 6개 | **20개** | +233% |
| 해결책 (Resolution) | 5개 | **15개** | +200% |
| 패턴 (Pattern) | 4개 | **8개** | +100% |
| 관계 (Relationship) | 58개 | **155개** | +167% |
| 장비 엔티티 | 9개 | **12개** | +33% |

---

## 3. 에러 코드 확장 상세

### 3.1 새로 추가된 카테고리

| 카테고리 | 에러 코드 | 설명 |
|----------|----------|------|
| communication | C1, C2, C4, C10-C17, C30, C31, C37, C171-C174 | 통신 관련 |
| system | C0, C3, C5, C14, C36, C200, C203, C900 | 시스템 |
| encoder | C25, C26, C40 | 엔코더 |
| calibration | C27, C29 | 캘리브레이션 |
| memory | C32, C33, C34, C38 | 메모리 |
| configuration | C35, C330, C333, C337, C338 | 설정 |
| power | C45, C207, C290-C299 | 전원 |
| joint_communication | C50-C55, C103 | 조인트 통신 |
| joint_position | C61, C72 | 조인트 위치 |
| joint_current | C70 | 조인트 전류 |
| joint_speed | C71 | 조인트 속도 |
| joint_temperature | C75, C77 | 조인트 온도 |
| safety | C119, C151-C160, C191-C194, C220 | 안전 |
| safety_io | C157, C259-C263 | 안전 I/O |
| io | C264-C279, C323 | 입출력 |
| tool | C281-C284 | 툴 |
| control_box | C285, C286, C289, C300 | 컨트롤 박스 |
| safety_board | C301, C303-C309 | 안전 보드 |
| motherboard | C312, C314, C315 | 마더보드 |
| teach_pendant | C316, C319-C321 | 티치 펜던트 |
| euromap | C325, C326, C328 | EUROMAP67 |
| hardware | C402, C450 | 하드웨어 |
| software | C500, C501, C503, C506, C509, C513, C517 | 소프트웨어 |
| sensor | C710, C740 | 센서 |
| overload | C189 | 과부하 |
| vibration | C204 | 진동 |

### 3.2 벤치마크 QA 커버리지

**error_code_qa.json** 에서 요구하는 에러 코드 커버리지:

| 에러 코드 | v1.0 | v2.0 | 비고 |
|----------|------|------|------|
| C103 | ❌ | ✅ | Joint 통신 타임아웃 |
| C151 | ❌ | ✅ | 안전 시스템 오류 |
| C200 | ❌ | ✅ | 시스템 오류 |
| C259 | ❌ | ✅ | 안전 I/O 설정 |
| C300 | ❌ | ✅ | 컨트롤 박스 오류 |
| C402 | ❌ | ✅ | 하드웨어 오류 |
| C500 | ❌ | ✅ | 소프트웨어 오류 |
| C710 | ❌ | ✅ | 센서 오류 |
| C900 | ❌ | ✅ | 시스템 크리티컬 |
| C32 | ❌ | ✅ | 플래시 쓰기 실패 |
| C45 | ❌ | ✅ | 조인트 전압 오류 |
| C740 | ❌ | ✅ | 힘 센서 오류 |
| C171 | ❌ | ✅ | 내부 통신 오류 |
| C173 | ❌ | ✅ | 외부 통신 오류 |
| C503 | ❌ | ✅ | 프로그램 오류 |
| C61 | ❌ | ✅ | 조인트 위치 오류 |

**커버리지: 0% → 100%**

---

## 4. 원인(Cause) 확장

### 4.1 새로 추가된 원인

| ID | 이름 | 카테고리 | 관련 에러 코드 |
|----|------|----------|---------------|
| CAUSE_COMMUNICATION_LOSS | 통신 손실 | electrical | C4, C10, C103, C171, C173 |
| CAUSE_POWER_ISSUE | 전원 문제 | electrical | C45, C290, C292, C293, C297 |
| CAUSE_OVERHEAT | 과열 | thermal | C75, C77, C286, C289 |
| CAUSE_SOFTWARE_BUG | 소프트웨어 오류 | software | C200, C500, C503, C333 |
| CAUSE_ENCODER_FAULT | 엔코더 결함 | mechanical | C25, C26 |
| CAUSE_SAFETY_CONFIG | 안전 설정 오류 | configuration | C119, C151 |
| CAUSE_IO_FAULT | I/O 결함 | electrical | C259 |
| CAUSE_HARDWARE_FAILURE | 하드웨어 고장 | hardware | C300, C301, C402, C900 |
| CAUSE_FIRMWARE_ISSUE | 펌웨어 문제 | software | C309, C315, C330 |
| CAUSE_MEMORY_FAULT | 메모리 결함 | hardware | C32, C38 |
| CAUSE_POSITION_ERROR | 위치 오차 | mechanical | C61, C153 |
| CAUSE_PROGRAM_ERROR | 프로그램 오류 | software | C71, C72 |
| CAUSE_EMERGENCY_STOP | 비상정지 활성화 | safety | C151, C159 |
| CAUSE_EXTERNAL_FORCE | 외부 힘 작용 | physical | 충돌 관련 |

---

## 5. 해결책(Resolution) 확장

### 5.1 새로 추가된 해결책

| ID | 이름 | 주요 단계 |
|----|------|----------|
| RES_REBOOT | 시스템 재부팅 | 전원 끄기 → 5분 대기 → 전원 켜기 |
| RES_UPDATE_FIRMWARE | 펌웨어 업데이트 | 다운로드 → 백업 → 업데이트 → 검증 |
| RES_CHECK_POWER | 전원 점검 | 케이블 → 전압 → 접지 → 전원장치 |
| RES_COOLING | 냉각 조치 | 작동 중지 → 15-30분 냉각 → 환기/팬 확인 |
| RES_SAFETY_CHECK | 안전 설정 점검 | 설정 검토 → 비상정지 → I/O → 재저장 |
| RES_CHECK_SAFETY_IO | 안전 I/O 점검 | 입력 → 출력 → 배선 → 설정 |
| RES_REPLACE_JOINT | 조인트 교체 | 서비스 연락 → 진단 → 교체 → 캘리브레이션 |
| RES_CONTACT_SUPPORT | 기술 지원 요청 | 로그 저장 → 지원 연락 → 설명 → 지시 따르기 |
| RES_CHECK_ENCODER | 엔코더 점검 | 상태 확인 → 청소 → 셀프테스트 → 교체 |
| RES_REINSTALL_SOFTWARE | 소프트웨어 재설치 | 백업 → 업데이트 확인 → 재설치 → 복원 |

---

## 6. 패턴(Pattern) 확장

### 6.1 새로 추가된 패턴

| ID | 이름 | 설명 | 관련 에러 코드 |
|----|------|------|---------------|
| PAT_COMMUNICATION_LOSS | 통신 손실 패턴 | 패킷 손실/통신 두절 | C4, C103, C50 |
| PAT_OVERHEAT | 과열 패턴 | 조인트/컨트롤박스 온도 상승 | C75, C77, C289 |
| PAT_SAFETY_VIOLATION | 안전 위반 패턴 | 안전 한계 초과 | C119, C151, C154, C159 |
| PAT_POSITION_DEVIATION | 위치 편차 패턴 | 경로 이탈 | C153, C61, C72 |

---

## 7. 장비 엔티티 확장

### 7.1 새로 추가된 장비

| ID | 타입 | 설명 |
|----|------|------|
| TeachPendant | TeachPendant | 티치 펜던트 (PolyScope) |
| SafetyControlBoard | SafetyBoard | Safety Control Board (SafetySys1, SafetySys2) |
| Motherboard | Motherboard | 마더보드 |

---

## 8. inference_rules.yaml 업데이트

### 8.1 변경 사항

| 항목 | v1.0 | v2.0 |
|------|------|------|
| 버전 | 1.0 | 2.0 |
| cause_rules | 4개 패턴 | 8개 패턴 |
| prediction_rules | 3개 | 6개 |
| pattern_error_mapping | 4개 | 8개 |
| error_cause_resolution | 없음 | 17개 에러 코드 매핑 |

### 8.2 새로 추가된 예측 규칙

- COMMUNICATION_PREDICTION: 통신 손실 → C103 예측
- OVERHEAT_PREDICTION: 과열 → C77 예측
- SAFETY_PREDICTION: 안전 위반 → C151 예측

### 8.3 error_cause_resolution 섹션

벤치마크 QA의 모든 에러 코드에 대해 원인-해결책 직접 매핑 추가:

```yaml
error_cause_resolution:
  C103:
    category: "joint_communication"
    causes: ["CAUSE_COMMUNICATION_LOSS", "CAUSE_CABLE_FAULT"]
    resolutions: ["RES_CHECK_CABLE", "RES_REBOOT"]
    description: "조인트 통신 타임아웃 - 케이블 연결 확인 후 재부팅"
  # ... 17개 에러 코드
```

---

## 9. 변경된 파일 목록

| 파일 | 변경 내용 |
|------|----------|
| `data/processed/ontology/ontology.json` | 전체 재작성 (v2.0) |
| `configs/inference_rules.yaml` | 확장 (v2.0) |

---

## 10. 검증

### 10.1 벤치마크 에러 코드 포함 확인

```powershell
# 모든 벤치마크 에러 코드가 온톨로지에 포함됨
C103: FOUND
C151: FOUND
C200: FOUND
C259: FOUND
C300: FOUND
C402: FOUND
C500: FOUND
C710: FOUND
C900: FOUND
C32: FOUND
C45: FOUND
C740: FOUND
C171: FOUND
C173: FOUND
C503: FOUND
C61: FOUND
```

### 10.2 예상 효과

1. **챗봇 응답률 향상**: 벤치마크 QA에서 ABSTAIN 응답 대폭 감소
2. **구조화된 정보 제공**: 에러 코드 → 원인 → 해결책 체인 완성
3. **예측 기능 강화**: 새로운 패턴-에러 매핑으로 예측 정확도 향상

---

## 11. 다음 단계

1. **챗봇 테스트**: 벤치마크 QA로 실제 응답 품질 검증
2. **RAG 연동 최적화**: 온톨로지 기반 응답 + RAG 상세 정보 결합
3. **피드백 반영**: 실제 사용에서 발견되는 누락 항목 추가

---

## 12. 참고 문서

- [온톨로지_스키마_설계.md](온톨로지_스키마_설계.md)
- [data/processed/ontology/ontology.json](../data/processed/ontology/ontology.json)
- [configs/inference_rules.yaml](../configs/inference_rules.yaml)
- [data/benchmark/error_code_qa.json](../data/benchmark/error_code_qa.json)
