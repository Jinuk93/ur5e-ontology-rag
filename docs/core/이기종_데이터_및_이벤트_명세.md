# 이기종 데이터 및 이벤트 명세

> **버전**: v2.0
> **데이터 기간**: 7일 (604,800 레코드)
> **데이터 타입**: 시뮬레이션 (합성 데이터)

---

## 1. 이기종 데이터 개요

본 시스템은 **두 가지 이기종 장비**의 데이터를 통합 분석합니다.

| 장비 | 제조사 | 역할 | 데이터 타입 |
|------|--------|------|-------------|
| **Axia80** | ATI (미국) | 6축 힘/토크 센서 | 실시간 측정 |
| **UR5e** | Universal Robots (덴마크) | 6축 협동로봇 | 텔레메트리 (합성) |

```
┌─────────────────────────────────────────────────────────────────┐
│                      이기종 데이터 통합                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   Axia80 (힘/토크 센서)          UR5e (협동로봇)                │
│   ┌─────────────────┐            ┌─────────────────┐           │
│   │ Fx, Fy, Fz (N)  │            │ tcp_speed (m/s) │           │
│   │ Tx, Ty, Tz (Nm) │            │ joint_torque    │           │
│   │ force_magnitude │            │ joint_current   │           │
│   │ force_spike     │            │ protective_stop │           │
│   └────────┬────────┘            └────────┬────────┘           │
│            │                              │                     │
│            └──────────────┬───────────────┘                     │
│                           │                                     │
│                           ▼                                     │
│              ┌─────────────────────────┐                        │
│              │     상관분석 엔진       │                        │
│              │  - torque_force_ratio   │                        │
│              │  - contact_risk_score   │                        │
│              │  - collision_risk_score │                        │
│              │  - anomaly_detected     │                        │
│              └─────────────────────────┘                        │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 2. Axia80 센서 데이터

### 2.1 장비 정보

| 항목 | 값 |
|------|-----|
| **모델명** | ATI Axia80 M8 |
| **제조사** | ATI Industrial Automation (미국) |
| **측정 축** | 6축 (Fx, Fy, Fz, Tx, Ty, Tz) |
| **샘플링 레이트** | 125 Hz (실제 측정) |
| **저장 레이트** | 1 Hz (1초 평균) |
| **장착 위치** | UR5e 툴플랜지 끝단 |

### 2.2 측정 필드

| 필드 | 타입 | 단위 | 측정 범위 | 정상 범위 | 설명 |
|------|------|------|----------|----------|------|
| `Fx` | float | N | -500 ~ +500 | -20 ~ +20 | X축 방향 힘 (수평) |
| `Fy` | float | N | -500 ~ +500 | -20 ~ +20 | Y축 방향 힘 (수평) |
| `Fz` | float | N | -1000 ~ +1000 | -60 ~ 0 | Z축 방향 힘 (수직, **가장 중요**) |
| `Tx` | float | Nm | -20 ~ +20 | -2 ~ +2 | X축 회전 토크 |
| `Ty` | float | Nm | -20 ~ +20 | -2 ~ +2 | Y축 회전 토크 |
| `Tz` | float | Nm | -20 ~ +20 | -0.5 ~ +0.5 | Z축 회전 토크 |

### 2.3 정상 운영 파라미터

#### 무부하 상태 (idle, approach, retract)

| 필드 | 평균 | 표준편차 | 비고 |
|------|------|----------|------|
| Fx | 0 | 2.0 | - |
| Fy | 0 | 2.0 | - |
| Fz | -15 | 3.0 | 그리퍼 자중 |
| Tx | 0 | 0.1 | - |
| Ty | 0 | 0.1 | - |
| Tz | 0 | 0.05 | - |

#### 작업 중 상태 (pick, place) - 페이로드별

| 페이로드 등급 | 무게 범위 | Fz 평균 | Fz 표준편차 |
|--------------|----------|---------|-------------|
| light | 0.5 ~ 1.5 kg | -30 N | 5.0 |
| normal | 1.5 ~ 3.0 kg | -50 N | 8.0 |
| heavy | 3.0 ~ 5.0 kg | -75 N | 10.0 |

---

## 3. UR5e 로봇 텔레메트리

### 3.1 장비 정보

| 항목 | 값 |
|------|-----|
| **모델명** | UR5e |
| **제조사** | Universal Robots (덴마크) |
| **자유도** | 6축 협동로봇 |
| **페이로드** | 5 kg |
| **리치** | 850 mm |
| **데이터 타입** | 합성 (시뮬레이션) |

### 3.2 측정 필드

| 필드 | 타입 | 단위 | 범위 | 설명 |
|------|------|------|------|------|
| `tcp_speed` | float | m/s | 0 ~ 1.0 | 툴 끝단(TCP) 이동 속도 |
| `tcp_acceleration` | float | m/s² | -5 ~ +5 | TCP 가속도 |
| `joint_torque_sum` | float | Nm | 0 ~ 150 | 6개 관절 토크 합계 |
| `joint_current_avg` | float | A | 0.5 ~ 5.0 | 평균 모터 전류 |
| `safety_mode` | enum | - | normal/reduced/protective_stop | 안전 모드 |
| `program_state` | enum | - | running/paused/stopped | 프로그램 상태 |
| `protective_stop` | bool | - | true/false | 보호정지 발생 여부 |

---

## 4. 파생 지표 (상관분석 엔진)

두 이기종 데이터를 결합하여 계산되는 파생 지표입니다.

| 필드 | 계산식 | 범위 | 설명 |
|------|--------|------|------|
| `force_magnitude` | √(Fx² + Fy² + Fz²) | 0 ~ 500 N | 합성 힘 크기 |
| `force_rate` | d\|F\|/dt | N/s | 힘 변화율 |
| `torque_force_ratio` | joint_torque_sum / max(\|F\|, 1) | - | 토크/힘 비율 |
| `contact_risk_score` | 복합 계산 | 0 ~ 1 | 접촉 위험도 |
| `collision_risk_score` | 복합 계산 | 0 ~ 1 | 충돌 위험도 |
| `anomaly_detected` | 토크↑ but 힘→ | bool | 이상 징후 (마모 등) |
| `recommended_action` | 위험도 기반 | enum | maintain/slow_down/stop/inspect |

---

## 5. 작업 컨텍스트

### 5.1 작업 모드 (Task Mode)

| 모드 | 설명 | 특성 |
|------|------|------|
| `idle` | 대기 상태 | 무부하, Fz ≈ -15N (그리퍼 자중) |
| `approach` | 접근 중 | 무부하, 이동 중 |
| `pick` | 집기 | 페이로드 + 그리퍼, Fz 증가 |
| `place` | 놓기 | 페이로드 해제 전 |
| `retract` | 복귀 | 무부하, 이동 중 |
| `stop` | 정지 | 보호정지 또는 비상정지 |

### 5.2 교대 근무 (Shift)

| 교대 | 시간 |
|------|------|
| A조 | 06:00 ~ 14:00 |
| B조 | 14:00 ~ 22:00 |
| C조 | 22:00 ~ 06:00 |

### 5.3 제품 (Product)

| 제품 ID | 페이로드 | 등급 |
|---------|----------|------|
| PART-A | 1.0 kg | light |
| PART-B | 2.5 kg | normal |
| PART-C | 4.2 kg | heavy |

### 5.4 툴 (Gripper)

| 툴 ID | 무게 | Fz baseline 변화 |
|-------|------|------------------|
| GRIPPER-01 | 1.5 kg | 기준 |
| GRIPPER-02 | 2.2 kg | -7N (무거움) |

---

## 6. 이벤트 타입

### 6.1 이벤트 분류

```
┌─────────────────────────────────────────────────────────────────┐
│                        이벤트 분류 체계                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 시나리오 A: 전조 → 이상 → 정지                          │   │
│  │ ├─ collision (충돌)                                     │   │
│  │ └─ 관련 에러: C153                                      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 시나리오 B: 반복 재발                                    │   │
│  │ ├─ overload (과부하)                                    │   │
│  │ └─ 관련 에러: C189 (4일차에 발생)                       │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │ 시나리오 C: 오탐/유사 증상                               │   │
│  │ ├─ tool_change (툴 교체)                                │   │
│  │ ├─ recalibration (캘리브레이션)                         │   │
│  │ └─ drift_no_doc (드리프트, 문서 없음)                   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 이벤트 상세

#### collision (충돌)

| 항목 | 값 |
|------|-----|
| **설명** | 급격한 외부 충격으로 인한 힘 급증 |
| **트리거** | Fz < -200N (100ms 이내 급락) |
| **Fz 피크** | -600 ~ -900 N |
| **지속시간** | 50 ~ 200 ms |
| **전조** | 진동 증가 20분 전 |
| **결과** | Safety Stop |
| **관련 에러** | C153, C119 |

#### overload (과부하)

| 항목 | 값 |
|------|-----|
| **설명** | 페이로드 초과로 인한 지속적 과부하 |
| **트리거** | \|Fz\| > 150N (5초 이상 지속) |
| **Fz 값** | -320 ~ -400 N |
| **지속시간** | 10 ~ 25 초 |
| **패턴** | 반복 재발 (4일 연속) |
| **관련 에러** | C189 (4일차) |

#### drift (드리프트)

| 항목 | 값 |
|------|-----|
| **설명** | 센서 baseline 대비 점진적 이탈 |
| **트리거** | baseline 대비 10%+ (30분 이상) |
| **편차량** | ±1.5 ~ 3.0 N |
| **지속시간** | 1 ~ 16 시간 |
| **관련 에러** | 없음 (ABSTAIN 예상) |

#### tool_change (툴 교체)

| 항목 | 값 |
|------|-----|
| **설명** | 그리퍼 교체로 인한 baseline 변화 |
| **발생 빈도** | 주 3회 |
| **Fz 변화** | ±7 N |
| **결과** | 정상 운영 (오탐 가능) |

#### recalibration (캘리브레이션)

| 항목 | 값 |
|------|-----|
| **설명** | 센서 캘리브레이션 후 값 점프 |
| **발생 빈도** | 주 2회 |
| **오프셋** | ±2 N |
| **결과** | 정상 운영 (오탐 가능) |

---

## 7. 패턴 타입

### 7.1 감지 패턴 요약

| 패턴 타입 | 감지 건수 | 관련 에러 | 신뢰도 |
|----------|----------|----------|--------|
| **collision** | 2건 | C153, C119 | 1.0 |
| **overload** | 4건 | C189 | 1.0 |
| **drift** | 11건 | - | 0.95 ~ 1.0 |

### 7.2 패턴-이벤트 매핑

| 패턴 ID | 패턴 타입 | 이벤트 ID | 발생 시각 | 주요 지표 |
|---------|----------|----------|-----------|----------|
| PAT-001 | collision | EVT-001 | 01/17 14:00 | Fz=-829N |
| PAT-002 | collision | EVT-002 | 01/20 10:00 | Fz=-815N |
| PAT-003 | overload | EVT-003 | 01/16 14:17 | Fz=328N, 9초 |
| PAT-004 | overload | EVT-004 | 01/17 14:32 | Fz=369N, 22초 |
| PAT-005 | overload | EVT-005 | 01/18 14:12 | Fz=364N, 22초 |
| PAT-006 | overload | EVT-006 | 01/19 14:30 | Fz=395N, 23초 |
| PAT-015 | drift | EVT-010 | 01/21 11:55 | 드리프트 15N |

---

## 8. 시나리오별 상세

### 8.1 시나리오 A: 전조 → 충돌 → 정지

```
시간 흐름:
─────────────────────────────────────────────────────────────────

T-20min        T-0              T+1min
  │              │                │
  ▼              ▼                ▼
┌────────┐  ┌─────────┐  ┌──────────────┐
│전조    │  │충돌     │  │Safety Stop   │
│진동 30%│→ │Fz=-820N │→ │에러 C153     │
│증가    │  │50-200ms │  │프로그램 정지 │
└────────┘  └─────────┘  └──────────────┘

─────────────────────────────────────────────────────────────────
```

**발생 이벤트:**
- EVT-001: 01/17 13:40 ~ 14:00 (B조, Fz=-824N)
- EVT-002: 01/20 09:40 ~ 10:00 (A조, PART-C, Fz=-817N)

### 8.2 시나리오 B: 반복 재발

```
일자별 패턴:
─────────────────────────────────────────────────────────────────

 1일차         2일차         3일차         4일차
 01/16         01/17         01/18         01/19
   │             │             │             │
   ▼             ▼             ▼             ▼
┌──────┐     ┌──────┐     ┌──────┐     ┌──────────┐
│과부하│     │과부하│     │과부하│     │과부하    │
│321N  │     │364N  │     │366N  │     │397N      │
│10초  │     │23초  │     │23초  │     │24초      │
│      │     │      │     │      │     │→ C189    │
└──────┘     └──────┘     └──────┘     └──────────┘

─────────────────────────────────────────────────────────────────

공통점: B조(14시대), PART-C(heavy), 점진적 악화
```

**발생 이벤트:**
- EVT-003: 01/16 14:17 (1일차, 에러 없음)
- EVT-004: 01/17 14:32 (2일차, 에러 없음)
- EVT-005: 01/18 14:12 (3일차, 에러 없음)
- EVT-006: 01/19 14:30 (4일차, **C189 발생**)

### 8.3 시나리오 C: 오탐/유사 증상

| 이벤트 | 타입 | 설명 | 결과 |
|--------|------|------|------|
| EVT-007 | tool_change | GRIPPER-02로 교체, Fz -7N 이동 | 정상 (오탐 가능) |
| EVT-008 | tool_change | GRIPPER-01로 교체, Fz +7N 복귀 | 정상 (오탐 가능) |
| EVT-009 | recalibration | 센서 캘리브레이션, 오프셋 +2N | 정상 (오탐 가능) |
| EVT-010 | drift_no_doc | 드리프트 15N, 4시간 | **ABSTAIN** (문서 없음) |

---

## 9. 실시간 스트림 데이터

### 9.1 통합 스트림 구조 (IntegratedStreamData)

```json
{
  "timestamp": "2024-01-17T14:00:00.000Z",

  "scenario": {
    "current": "collision",        // normal | high_force | contact | collision | overload | wear | risk_approach
    "elapsed_sec": 0.5
  },

  "axia80": {
    "Fx": 2.5,
    "Fy": -1.8,
    "Fz": -450.0,
    "Tx": 0.1,
    "Ty": -0.2,
    "Tz": 0.05,
    "force_magnitude": 450.02,
    "force_spike": true
  },

  "ur5e": {
    "tcp_speed": 0.02,
    "joint_torque_sum": 85.5,
    "joint_current_avg": 3.2,
    "protective_stop": true
  },

  "correlation": {
    "torque_force_ratio": 0.19,
    "anomaly_detected": false
  },

  "risk": {
    "risk_level": "critical",      // low | medium | high | critical
    "contact_risk_score": 0.95,
    "collision_risk_score": 0.98
  }
}
```

### 9.2 시나리오별 특성

| 시나리오 | Fz 범위 | tcp_speed | 위험도 | 설명 |
|----------|---------|-----------|--------|------|
| `normal` | -30 ~ -10N | 0.2~0.4 m/s | 0.1~0.2 | 정상 작동 |
| `high_force` | -80 ~ -50N | 0.3~0.5 m/s | 0.4~0.6 | 힘 증가 |
| `contact` | -150 ~ -80N | 0.1~0.3 m/s | 0.6~0.8 | 접촉 감지 |
| `collision` | -350 ~ -200N | 0~0.1 m/s | 0.8~1.0 | 충돌 |
| `overload` | -150N+ (지속) | 유지 | 0.7~0.9 | 과부하 |
| `wear` | 드리프트 | 유지 | 0.5~0.7 | 마모 |
| `risk_approach` | -100 ~ -50N | 0.4~0.6 m/s | 0.5~0.7 | 위험 접근 |

---

## 10. 관련 에러 코드

| 에러 코드 | 설명 | 관련 패턴 | 원인 |
|----------|------|----------|------|
| **C153** | 충돌 감지 Safety Stop | collision | 외부 충격, 장애물 |
| **C119** | 보호 정지 | collision | 안전 기능 발동 |
| **C189** | 과부하 에러 | overload | 페이로드 초과 |

---

## 11. 데이터 품질

| 품질 등급 | 비율 | 설명 |
|----------|------|------|
| good | 98% | 정상 데이터 |
| delayed | 1% | 지연 데이터 |
| interpolated | 0.5% | 보간 데이터 |
| missing | 0.5% | 누락 데이터 |

**추가 품질 이슈:**
- Clock skew: ±50ms
- Drop duration: 5~15초

---

## 12. 파일 경로

```
data/sensor/
├── metadata/
│   └── sensor_config.yaml          # 센서 설정 (본 문서의 원본)
│
├── processed/
│   ├── anomaly_events.json         # 이벤트 목록 (10건)
│   ├── detected_patterns.json      # 패턴 목록 (17건)
│   └── validation_results.json     # 검증 결과
│
└── raw/
    └── sensor_readings.parquet     # 원시 센서 데이터 (604,800건)
```

---

## 13. API 엔드포인트

| 엔드포인트 | 메서드 | 설명 |
|-----------|--------|------|
| `/api/sensors/readings` | GET | 센서 측정값 조회 |
| `/api/sensors/events` | GET | 이벤트 목록 조회 |
| `/api/sensors/patterns` | GET | 패턴 목록 조회 |
| `/api/sensors/predictions` | GET | 예측 데이터 조회 |
| `/api/sensors/stream` | GET (SSE) | 실시간 센서 스트림 |
| `/api/sensors/stream/integrated` | GET (SSE) | 통합 스트림 (Axia80+UR5e) |
