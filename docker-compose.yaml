# ============================================================
# docker-compose.yaml - 컨테이너 서비스 정의
# ============================================================
# Docker Compose란?
#   여러 컨테이너(앱)를 한 번에 정의하고 실행하는 도구
#
# 실행 명령어:
#   docker-compose up -d     → 백그라운드에서 실행
#   docker-compose down      → 모든 컨테이너 종료
#   docker-compose logs      → 로그 확인
#   docker-compose ps        → 실행 중인 컨테이너 확인
# ============================================================


# version은 Docker Compose 파일 형식 버전 (최신은 생략 가능)
version: "3.8"


# ------------------------------------------------------------
# services: 실행할 컨테이너들 정의
# ------------------------------------------------------------
services:

  # ==========================================================
  # [1] Neo4j - 그래프 데이터베이스
  # ==========================================================
  # Neo4j란?
  #   - 노드(점)와 관계(선)로 데이터를 저장하는 DB
  #   - 우리 프로젝트에서: 온톨로지(지식그래프) 저장
  #   - 예: (에러코드 C153) -[원인]-> (브레이크 이상) -[조치]-> (브레이크 점검)
  # ==========================================================
  neo4j:
    image: neo4j:5.15.0                    # 사용할 Docker 이미지 (Neo4j 공식)
    container_name: ur5e-neo4j             # 컨테이너 이름 (구분용)

    ports:                                  # 포트 매핑 (호스트:컨테이너)
      - "7474:7474"                         # Neo4j 웹 브라우저 UI (http://localhost:7474)
      - "7687:7687"                         # Bolt 프로토콜 (Python 코드에서 접속)

    environment:                            # 환경변수 설정
      - NEO4J_AUTH=neo4j/password123        # 초기 인증 정보 (사용자/비밀번호)
      - NEO4J_PLUGINS=["apoc"]              # APOC 플러그인 (고급 기능용)
      # 참고: 실제 운영에서는 강력한 비밀번호 사용!

    volumes:                                # 볼륨 마운트 (데이터 영속성)
      - ./stores/neo4j/data:/data           # Neo4j 데이터 저장 위치
      - ./stores/neo4j/logs:/logs           # 로그 파일 저장 위치
      # 볼륨이란? 컨테이너 삭제해도 데이터 유지됨

    restart: unless-stopped                 # 컨테이너 재시작 정책


  # ==========================================================
  # [2] ChromaDB - 벡터 데이터베이스 (선택적)
  # ==========================================================
  # ChromaDB란?
  #   - 텍스트를 벡터(숫자 배열)로 변환해서 저장
  #   - "의미적으로 유사한" 문서 검색 가능
  #   - 예: "로봇 팔이 안 움직여요" → 관련 매뉴얼 페이지 검색
  #
  # 참고: ChromaDB는 Python 패키지로도 사용 가능 (서버 없이)
  #       이 프로젝트에서는 일단 Python 패키지로 사용 예정
  # ==========================================================
  # chroma:
  #   image: chromadb/chroma:latest
  #   container_name: ur5e-chroma
  #   ports:
  #     - "8000:8000"
  #   volumes:
  #     - ./stores/chroma:/chroma/chroma
  #   restart: unless-stopped


# ------------------------------------------------------------
# volumes: 명명된 볼륨 정의 (선택적)
# ------------------------------------------------------------
# 볼륨을 명시적으로 정의하면 Docker가 관리해줌
# 여기서는 로컬 경로 직접 매핑을 사용하므로 생략
# ------------------------------------------------------------


# ------------------------------------------------------------
# networks: 네트워크 정의 (선택적)
# ------------------------------------------------------------
# 컨테이너들이 서로 통신할 네트워크
# 기본값 사용하므로 생략 가능
# ------------------------------------------------------------
