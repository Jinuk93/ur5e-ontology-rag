# ============================================================
# docker-compose.yaml - 컨테이너 서비스 정의
# ============================================================
# Docker Compose란?
#   여러 컨테이너(앱)를 한 번에 정의하고 실행하는 도구
#
# 실행 명령어:
#   docker-compose up -d     → 백그라운드에서 실행
#   docker-compose down      → 모든 컨테이너 종료
#   docker-compose logs      → 로그 확인
#   docker-compose ps        → 실행 중인 컨테이너 확인
#
# Neo4j 브라우저: http://localhost:7474
# ============================================================

version: "3.8"

# ------------------------------------------------------------
# services: 실행할 컨테이너들 정의
# ------------------------------------------------------------
services:

  # ==========================================================
  # [1] Neo4j - 그래프 데이터베이스
  # ==========================================================
  # Neo4j란?
  #   - 노드(점)와 관계(선)로 데이터를 저장하는 DB
  #   - 우리 프로젝트에서: 온톨로지(지식그래프) 저장
  #   - 예: (에러코드 C153) -[원인]-> (브레이크 이상) -[조치]-> (브레이크 점검)
  # ==========================================================
  neo4j:
    image: neo4j:5.15-community
    container_name: ur5e-neo4j

    ports:
      - "7474:7474"   # Neo4j 웹 브라우저 UI
      - "7687:7687"   # Bolt 프로토콜 (Python 코드에서 접속)

    environment:
      - NEO4J_AUTH=neo4j/password123
      - NEO4J_PLUGINS=["apoc"]
      - NEO4J_apoc_export_file_enabled=true
      - NEO4J_apoc_import_file_enabled=true
      - NEO4J_apoc_import_file_use__neo4j__config=true
      # 참고: 실제 운영에서는 강력한 비밀번호 사용!

    volumes:
      - ./stores/neo4j/data:/data
      - ./stores/neo4j/logs:/logs
      - ./stores/neo4j/import:/var/lib/neo4j/import

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:7474"]
      interval: 10s
      timeout: 5s
      retries: 5

    restart: unless-stopped


  # ==========================================================
  # [2] ChromaDB - 벡터 데이터베이스 (선택적)
  # ==========================================================
  # ChromaDB란?
  #   - 텍스트를 벡터(숫자 배열)로 변환해서 저장
  #   - "의미적으로 유사한" 문서 검색 가능
  #   - 예: "로봇 팔이 안 움직여요" → 관련 매뉴얼 페이지 검색
  #
  # 참고: 이 프로젝트에서는 Python 패키지로 사용 예정
  # ==========================================================
  # chroma:
  #   image: chromadb/chroma:latest
  #   container_name: ur5e-chroma
  #   ports:
  #     - "8000:8000"
  #   volumes:
  #     - ./stores/chroma:/chroma/chroma
  #   restart: unless-stopped
